# 6.受注一覧

# ワイヤーフレーム
![デザイン](https://cacoo.com/diagrams/U7E6XRzg0nfwjYh1-A4362.png)
[プレビュー](https://cacoo.com/diagrams/U7E6XRzg0nfwjYh1/A4362)

## 概要
[参照](https://github.com/LavaJavaSystemInc/tamada-coresystem-oldapp/blob/6e0f129fc3f15f0de8cd69b7a0216aacc9f26cab/Order/TAA0500_20220922_1/TAA0502D.aspx)

## エンドポイント
`/order`

## 画面背景色
「ライトモード」及び「ダークモード」をボタン切替できるようにする

## 検索条件のデフォルト設定
- 「担当部署」：ログイン者の所属部署を選択
- 「担当営業」：ログイン者の社員名を選択
- 「物件状況」：「受注残」を選択
- 「表示順１」：「受注番号」を選択

## 1. 受注先オートコンプリート
[こちらの仕様を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/3.%E5%95%86%E8%AB%87%E4%B8%80%E8%A6%A7.md#1-%E5%8F%97%E6%B3%A8%E5%85%88%E3%82%AA%E3%83%BC%E3%83%88%E3%82%B3%E3%83%B3%E3%83%97%E3%83%AA%E3%83%BC%E3%83%88)

## 2. 施設名オートコンプリート
[こちらの仕様を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/4.%E5%95%86%E8%AB%87%E5%85%A5%E5%8A%9B.md#10-%E6%96%BD%E8%A8%AD%E5%90%8D%E3%82%AA%E3%83%BC%E3%83%88%E3%82%B3%E3%83%B3%E3%83%97%E3%83%AA%E3%83%BC%E3%83%88)

## 3. 新規作成・参照新規・編集モード（受注訂正）
[7.受注入力画面](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/7.%E5%8F%97%E6%B3%A8%E5%85%A5%E5%8A%9B.md)に遷移  
※受注入力画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）。但し、新規作成ボタン押下時は対象外

## 4. 受注取消
   1. 事前チェック  
      以下をチェックを行う
      - 取消対象の「状況」が"受注残"以外の場合、「受注完了済のため、取消はできません。」のエラーメッセージを表示する
      - 取消対象の「依頼」が"有仮"の場合、「製造依頼があるため、取消はできません。」のエラーメッセージを表示する
   2. [受注取消モーダル](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/12.%E5%8F%97%E6%B3%A8%E5%8F%96%E6%B6%88%E3%83%A2%E3%83%BC%E3%83%80%E3%83%AB.md)を表示  
      ※受注取消モーダルへ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 5. 受注完了
   1. 事前チェック  
      以下をチェックを行う  
      - 完了対象の「完了日」が未設定('')以外の場合、「選択された受注は完了しています。」のエラーメッセージを表示する
      - 完了対象の「受注申請」が"決裁"以外（受注.受注ＰＥ申請フラグが'5'以外）の場合、「受注の決済がされていません。受注完了処理はできません。」エラーメッセージを表示する
      - 完了対象の「据付レポート申請」が"未申請"の場合、「据付レポートが申請されていません。受注完了処理はできません。」のエラーメッセージを表示する
      - 下記、売上APIで取得した仕訳連携フラグが未設定('')以外の場合、「売上計上されています。受注情報の変更はできません。」のエラーメッセージを表示する
         - [37.売上API](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/37.%E5%A3%B2%E4%B8%8A.md)の[getSales](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/37.%E5%A3%B2%E4%B8%8A.md#getsales%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF)クエリを用いて仕訳連携フラグを取得
         #### リクエストパラメータ
         ```json
            getSales(
               request: {
                  order_no: "..."
               }
            )
         ```
         - order_no: 前画面から引き継がれた受注番号
         - 各項目のマッピングは[売上シートの備考を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/schema/%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E8%A8%AD%E8%A8%88%E6%9B%B8.xlsx)
   2. [受注完了モーダル](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/11.%E5%8F%97%E6%B3%A8%E5%AE%8C%E4%BA%86%E3%83%A2%E3%83%BC%E3%83%80%E3%83%AB.md)を表示  
      ※受注完了モーダルへ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 6. 製造依頼登録
[8.製造依頼](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/8.%E8%A3%BD%E9%80%A0%E4%BE%9D%E9%A0%BC.md)に遷移  
※製造依頼画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 7. 地図・出荷チェックリスト
[15.地図・出荷チェックリスト](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/15.%E5%9C%B0%E5%9B%B3%E3%83%BB%E5%87%BA%E8%8D%B7%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%83%AA%E3%82%B9%E3%83%88.md)に遷移  
※地図・出荷チェックリスト画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 8. 調整金具登録
[10.調整金具登録](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/10.%E8%AA%BF%E6%95%B4%E9%87%91%E5%85%B7%E7%99%BB%E9%8C%B2.md)に遷移  
※調整金具登録画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 9. 据付レポート
   1. 事前チェック  
      以下をチェックを行う
      - 提出対象の「据付レポート提出」が"不要"の場合、「据付レポート提出の必要はありません。」のエラーメッセージを表示する
   2. [16.据付レポート入力・申請](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/16.%E6%8D%AE%E4%BB%98%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E5%85%A5%E5%8A%9B%E3%83%BB%E7%94%B3%E8%AB%8B.md)に遷移  
      ※据付レポート入力・申請画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 10. 請求状況確認
[17.請求入金検収支払一覧](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/17.%E8%AB%8B%E6%B1%82%E5%85%A5%E9%87%91%E6%A4%9C%E5%8F%8E%E6%94%AF%E6%89%95%E4%B8%80%E8%A6%A7.md)に遷移  
※請求入金検収支払一覧画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 11. 請求書発行
[13.請求書発行](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/13.%E8%AB%8B%E6%B1%82%E6%9B%B8%E7%99%BA%E8%A1%8C.md)に遷移  
※請求書発行(依頼)画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 12. 支払完了登録
[19.支払完了登録](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/19.%E6%94%AF%E6%89%95%E5%AE%8C%E4%BA%86%E7%99%BB%E9%8C%B2.md)に遷移  
※支払完了登録画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 13. ライニング入力
   1. 事前チェック  
      以下をチェックを行う
      - 受注区分が「一般工事(11)」または「ライニング工事(12)」の両工事以外の場合、「ライニング工事の受注ではありません。」のエラーメッセージを表示する
      - 施設名が入力されていない場合、「施設が設定されていません。ライニング入力に遷移できません。」のエラーメッセージを表示する
      - 施設名が「仮施設」（施設コードが"09999999"）の場合、「選択された受注の施設は仮施設です。ライニング入力に遷移できません。」のエラーメッセージを表示する
   2. [21.受注入力（ライニング情報）](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/21.%E5%8F%97%E6%B3%A8%E5%85%A5%E5%8A%9B%EF%BC%88%E3%83%A9%E3%82%A4%E3%83%8B%E3%83%B3%E3%82%B0%E6%83%85%E5%A0%B1%EF%BC%89.md)に遷移  
      ※受注入力（ライニング情報）画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 14. ライニング帳票
   1. 事前チェック  
      以下をチェックを行う
      - 受注区分が「一般工事(11)」または「ライニング工事(12)」の両工事以外の場合、「ライニング工事の受注ではありません。」のエラーメッセージを表示する
      - 施設名が入力されていない場合、「施設が設定されていません。ライニング入力に遷移できません。」のエラーメッセージを表示する
      - 施設名が「仮施設」（施設コードが"09999999"）の場合、「選択された受注の施設は仮施設です。ライニング入力に遷移できません。」のエラーメッセージを表示する
   2. [22.提出資料作成指定](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/22.%E6%8F%90%E5%87%BA%E8%B3%87%E6%96%99%E4%BD%9C%E6%88%90%E6%8C%87%E5%AE%9A.md)に遷移  
      ※提出資料作成指定画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 15. 施設情報入力
TBD（施設情報入力画面は今回のスコープ外となったため、ボタンのみ配置）

## 16. 検索
   1. 事前チェック  
      以下のチェックを行う
      - 項目相関チェック  
         - 「受注番号(開始)」が未設定('')以外、かつ「受注番号(終了)」が未設定('')以外の場合、以下をチェックする  
            - 「受注番号(開始)」 > 「受注番号(終了)」の場合、「受注番号(開始)と受注番号(終了)の関係に誤りがあります。」のエラーメッセージを表示する
   2. [4.受注API](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/4.%E5%8F%97%E6%B3%A8.md)の[getOrders](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/4.%E5%8F%97%E6%B3%A8.md#%E3%82%AF%E3%82%A8%E3%83%AA)クエリを用いて検索結果を表示
      #### リクエストパラメータ
      ```json
         getOrders(
            request: {
               ...
            }
         )
      ```
      - ...は[getOrdersパラメータ](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/4.%E5%8F%97%E6%B3%A8.md#getorders%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF)を参照  
         - no_s: 受注番号(自)
         - no_e: 受注番号(至)
         - date_s: 受注日(自)(YYYYMMDD形式)
         - date_e: 受注日(至)(YYYYMMDD形式)
         - jucy_code: 受注区分
         - sysi_code: 受注詳細区分
         - branch_code: 管轄支店
         - department_code: 担当部署
         - owner_code: 担当営業者
         - worker_code: 工事担当者
         - order_dest_name: 受注先名
         - order_dest_code: 受注先コード
         - tank_delivery_at_s: タンク引渡日(自)(YYYYMMDD形式)
         - tank_delivery_at_e: タンク引渡日(至)(YYYYMMDD形式)
         - work_delivery_at_s: 工事引渡日(自)(YYYYMMDD形式)
         - work_delivery_at_e: 工事引渡日(至)(YYYYMMDD形式)
         - site_name: 現場名
         - site_address: 現場住所
         - facility_name: 施設名
         - facility_code: 施設コード
         - is_paid: 支払完了
         - order_status: 物件状況
         - complete_at_s: 完了日(自)(YYYYMMDD形式)
         - complete_at_e: 完了日(至)(YYYYMMDD形式)
         - sort_column1: 表示順１ソート対象カラム(指定する値は日本語カラム名（DBの物理カラム名）)  
            - 指定する値について、プルダウンにて表示している[19.コードマスタプルダウン](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/6.%E5%8F%97%E6%B3%A8%E4%B8%80%E8%A6%A7.md#19-%E3%82%B3%E3%83%BC%E3%83%89%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)で取得したコード.略称(ryaku_name)ではなく、コード.文字１(str1)を設定する
         - order1: 表示順１（昇順・降順）
         - sort_column2: 表示順２ソート対象カラム(指定する値は日本語カラム名（DBの物理カラム名）)  
            - 指定する値について、プルダウンにて表示している[19.コードマスタプルダウン](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/6.%E5%8F%97%E6%B3%A8%E4%B8%80%E8%A6%A7.md#19-%E3%82%B3%E3%83%BC%E3%83%89%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)で取得したコード.略称(ryaku_name)ではなく、コード.文字１(str1)を設定する
         - order2: 表示順２（昇順・降順）
         - sort_column3: 表示順３ソート対象カラム(指定する値は日本語カラム名（DBの物理カラム名）)  
            - 指定する値について、プルダウンにて表示している[19.コードマスタプルダウン](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/6.%E5%8F%97%E6%B3%A8%E4%B8%80%E8%A6%A7.md#19-%E3%82%B3%E3%83%BC%E3%83%89%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)で取得したコード.略称(ryaku_name)ではなく、コード.文字１(str1)を設定する
         - order3: 表示順３（昇順・降順）
         - page: ページ
         - size: 50(固定)
         - 各項目のマッピングは[受注シートの備考を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/schema/%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E8%A8%AD%E8%A8%88%E6%9B%B8.xlsx)
   3. 取得した検索結果を一覧表示する
      - 「No」：1から連番を設定  ※次ページへ遷移した場合は、前ページの最終Noからの連番とする
      - 「受注番号」：受注.受注番号(no)を設定
      - 「受注先名」：受注.受注先名(order_dest_name)を設定
      - 「現場名」：受注.現場名(size_name)を設定
      - 「現場住所」：受注.現場住所(size_address)を設定
      - 「受注区分」、「詳細区分」、「受注申請」、「予算申請」：リレーションされているコード.略称(ryaku_name)を設定
      - 「ＡＢ」：受注.ＡＢ手配済(is_ab)が'1'の場合、"済"を設定。'1'以外の場合、未設定('')を設定
      - 「注文」：受注.注文書有無(is_form)が'1'の場合、"有"を設定。'1'以外の場合、未設定('')を設定
      - 「依頼」：以下の「1.」及び「2.」で決定した設定値を結合した値（ex. 有仮）
         1. 受注.製造依頼ＰＥ申請F(peif_code2) = '5'の場合、製造依頼情報(manufacture_requests)を取得
            - [7.製造依頼API](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/7.%E8%A3%BD%E9%80%A0%E4%BE%9D%E9%A0%BC.md)の[getManufactureRequests](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/7.%E8%A3%BD%E9%80%A0%E4%BE%9D%E9%A0%BC.md#%E3%82%AF%E3%82%A8%E3%83%AA)クエリを用いて製造依頼情報を取得
               #### リクエストパラメータ
              ```json
                  getManufactureRequests(
                     request: {
                        order_no: "..."
                     }
                  )
               ```
               - order_no: 前画面から引き継がれた受注番号
               - 各項目のマッピングは[製造依頼シートの備考を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/schema/%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E8%A8%AD%E8%A8%88%E6%9B%B8.xlsx)
            - 情報有無による設定値決定
               - 取得できた場合は'有'、取得できなかった場合は未設定('')を設定値とする    
         2. 受注.製造依頼ＰＥ申請F(peif_code2) = '5'の場合、受注明細入力の明細毎に以下の条件判定を行う  
            設定値が未設定('')となった場合は次明細の判定へ進み、'仮'となった場合は設定値確定として条件判定を終了する。1明細も設定値が'仮'にならなかった場合は未設定('')を設定値とする
            - 製品コード判定
               - 受注明細.製品コード(product_code)の先頭桁 <> '2'の場合、未設定('')を設定値とする
               - 受注明細.製品コード(product_code)の先頭桁 = '2'の場合、タンク種別判定を行う
            - タンク種別判定  
               - タンク種別を取得
                  [38.コードAPI](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/38.%E3%82%B3%E3%83%BC%E3%83%89.md)の[getCodes](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/38.%E3%82%B3%E3%83%BC%E3%83%89.md#%E3%82%AF%E3%82%A8%E3%83%AA)クエリを用いてを指定して区分１(kind1)を取得
                  #### リクエストパラメータ
                  ```json
                     getCodes(
                        request: {
                           kind_code: "...",
                           code: "..."
                        }
                     )
                  ```
                  - kind_code: TANK
                  - code: 受注明細.製品コード(product_code)の2～3桁目の2桁
                  - 各項目のマッピングは[コードシートの備考を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/schema/%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E8%A8%AD%E8%A8%88%E6%9B%B8.xlsx)  
               - タンク種別コード(tank_code).区分１(kind1)を判定
                  - '1'または'2'の場合、タンク図面確定フラグ判定を行う。その他は未設定('')を設定値とする
            - タンク図面確定フラグ判定
               - 製造仕様取得
                  - [8.製造仕様API](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/8.%E8%A3%BD%E9%80%A0%E4%BB%95%E6%A7%98.md)の[getManufactureSpecifications](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/8.%E8%A3%BD%E9%80%A0%E4%BB%95%E6%A7%98.md#%E3%82%AF%E3%82%A8%E3%83%AA)クエリを用いて受注番号に紐づく製造仕様一覧を取得  
                     #### リクエストパラメータ
                     ```json
                        getManufactureSpecifications	(
                           request: {
                              order_no: "...",
                              detail_no: "..."
                           }
                        )
                     ```
                    - order_no: 受注明細.受注番号(order_no)
                    - detail_no: 受注明細.明細番号(detail_no)
                    - 各項目のマッピングは[製造仕様シートの備考を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/schema/%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E8%A8%AD%E8%A8%88%E6%9B%B8.xlsx)  
               - フラグ判定
                  - 製造仕様(manufacture_specification).タンク図面確定フラグ(tank_drawing_decision_flag) <> '1'の場合、製造依頼情報の取得を行う。その他は未設定('')を設定値とする
            - 製造依頼情報有無判定
               - 製造依頼(manufacture_request)が存在する場合、'仮'を設定値とする。その他は未設定('')を設定値とする
      - 「状況」：下記参照
         - 入金額の算出  
           受注.請求番号１の入金額(invoice1_no.billing_deposit.deposit_amount)+請求番号２の入金額(invoice2_no.billing_deposit.deposit_amount)+請求番号３の入金額(invoice3_no.billing_deposit.deposit_amount)
         - 請求額の算出  
            - 受注.請求額１(invoice1_amount) + 受注.請求額２(invoice2_amount) + 受注.請求額３(invoice3_amount) + 消費税額
            - 消費税額の算出
              - 受注.請求番号１(invoice1_no).消費税額(tax) + 受注.請求番号２(invoice2_no).消費税額(tax) + 受注.請求番号３(invoice3_no).消費税額(tax)
         - 状況の判定
            - 以下の各条件にて設定値を決定する
               - 受注.削除フラグ(del_flag)が'1'の場合、「受注取消」を設定
               - 受注.削除フラグ(del_flag)が'1'以外の場合
                  - 受注.完了日(complete_at) <> ''の場合
                     - 受注.請求書発行済フラグ(is_issue_invoice)が'1'または'2'の場合、上記の「入金額の算出」及び「請求額の算出」で求めた入金額、請求額を判定
                        - (請求額 >= 0 かつ 請求額 <= 入金額)または(請求額 < 0 かつ 請求額 >= 入金額)の場合、「入金済」を設定
                        - 入金額 <> 0 かつ ((請求額 >= 0 かつ 請求額 > 入金額)または(請求額 < 0 かつ 請求額 < 入金額))の場合、「部分入金」を設定
                        - 入金額 = 0の場合、「未入金」を設定
                        - 上記条件にあてはまらない場合は、「受注残」を設定
                     - 受注.請求書発行済フラグ(is_issue_invoice)が'1'以外かつ'2'以外の場合、「未請求」を設定
                  - 受注.完了日(complete_at) = ''の場合、「受注残」を設定
      - 「支払」：受注.支払完了日(paid_at)が未設定('')の場合、"未完了"を設定。未設定('')以外の場合、"完了"を設定
      - 「請求」：下記参照  
         - 請求回数(billing_request.billing_count)が1回目の「請求番号(billing_request.billing_no)」と「請求書発行済フラグ(billing_request.invoiced_flag)」をもとに以下の各条件にて設定値を決定する
            - 請求.請求番号 = ''、かつ請求依頼.請求書発行済フラグ = ''の場合、「依頼前」を設定
            - 請求.請求番号 = ''、かつ請求依頼.請求書発行済フラグ = '9'の場合、「保存中」を設定
            - 請求.請求番号 = ''、かつ請求依頼.請求書発行済フラグ <> ''の場合、「依頼中」を設定
            - 請求.請求番号 <> ''、かつ請求依頼.請求書発行済フラグ <> ''の場合、「発行済」を設定
      - 「受注金額」：受注.受注金額(order_amount)を3桁毎の','区切り表記（例：1,500）で設定
      - 「受注日」：受注.受注日(date)をYYYY/MM/DD形式にて設定
      - 「タンク引渡日」：受注.タンク引渡日(tank_delivery_at)をYYYY/MM/DD形式にて設定
      - 「決定」：受注.引渡決定(is_delivery)が'1'の場合、"決定"を設定。'1'以外の場合、未設定('')を設定
      - 「工事引渡日」：受注.工事引渡日(work_delivery_at)をYYYY/MM/DD形式にて設定
      - 「完了日」：受注.完了日(complete_at)をYYYY/MM/DD形式にて設定
      - 「管轄支店」：受注.管轄支店(branch_code).支店名(name)を設定  
      - 「担当部署」：受注.担当部署(department_code).部署名(name)を設定  
      - 「営業担当」：受注.担当者(owner_code).社員名(name)を設定  
      - 「工事担当」：受注.工事担当者(worker_code).社員名(name)を設定  
      - 「施設名」：受注.施設名(facility_name)を設定
      - 「地図・出荷チェックリスト」：地図(map)が存在する場合は"済"を設定。空の場合は未設定('')を設定
      - 「調整金具」：調整金具(adjustment_fitting)できた場合は"済"を設定。取得できなかった場合は未設定('')を設定
      - 「据付レポート申請」：下記参照
         1. 製造依頼(manufacture_requests)が空の場合、状況を「無し」、存在する場合、状況を「有り」とする
         2. 状況が「有り」の場合、据付レポート情報取得及び状況判定を行う
            - 据付レポート情報取得及び状況判定
               - 据付レポート(installation_report).依頼工場(request_factory) = "外注"の件数 == 1:の場合、状況を「無し」とする
         3. 判定した状況をもとに設定値を決定する
            - 状況が「無し」の場合、「不要」を設定
            - 状況が「無し」以外の場合
               - 据付レポート情報が取得できた場合：据付レポート.据付PE申請フラグ(peif_code)でリレーションされているコード.名称(name)を設定  
               - 据付レポート情報が取得できなかった場合：「未申請」を設定

## 17. 変更履歴
[20.変更履歴照会](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/20.%E5%A4%89%E6%9B%B4%E5%B1%A5%E6%AD%B4%E7%85%A7%E4%BC%9A.md)に遷移  
※変更履歴照会画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

## 18. CSV出力
   1. [60.受注CSV作成API](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/60.%E5%8F%97%E6%B3%A8CSV%E4%BD%9C%E6%88%90.md)の[makeOrdersCsv](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/60.%E5%8F%97%E6%B3%A8CSV%E4%BD%9C%E6%88%90.md#%E3%83%9F%E3%83%A5%E3%83%BC%E3%83%86%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3)ミューテーションを用いて受注一覧情報のCSVを出力  
   リクエストパラメータには、検索実行時と同じパラメータ値を設定する  
   検索実行が行われていない(検索パラメータがない)場合は、「CSV出力する受注一覧情報がありません」のメッセージを表示し、受注CSV作成APIはコールしない
      #### リクエストパラメータ
      ```json
         makeOrdersCsv(
            resuest {
               ...
            }
         )
      ```
      - ...は[makeOrdersCsvパラメータ](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/60.%E5%8F%97%E6%B3%A8CSV%E4%BD%9C%E6%88%90.md#makeorderscsv%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF)を参照  
         - no_s: 受注番号(自)
         - no_e: 受注番号(至)
         - date_s: 受注日(自)(YYYYMMDD形式)
         - date_e: 受注日(至)(YYYYMMDD形式)
         - jucy_code: 受注区分
         - sysi_code: 受注詳細区分
         - branch_code: 管轄支店
         - department_code: 担当部署
         - owner_code: 担当営業者
         - worker_code: 工事担当者
         - order_dest_name: 受注先名
         - order_dest_code: 受注先コード
         - tank_delivery_at_s: タンク引渡日(自)(YYYYMMDD形式)
         - tank_delivery_at_e: タンク引渡日(至)(YYYYMMDD形式)
         - work_delivery_at_s: 工事引渡日(自)(YYYYMMDD形式)
         - work_delivery_at_e: 工事引渡日(至)(YYYYMMDD形式)
         - site_name: 現場名
         - site_address: 現場住所
         - facility_name: 施設名
         - facility_code: 施設コード
         - is_paid: 支払完了
         - order_status: 物件状況
         - complete_at_s: 完了日(自)(YYYYMMDD形式)
         - complete_at_e: 完了日(至)(YYYYMMDD形式)
         - sort_column1: 表示順１ソート対象カラム(指定する値は日本語カラム名（DBの物理カラム名）)  
            - 指定する値について、プルダウンにて表示している[19.コードマスタプルダウン](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/6.%E5%8F%97%E6%B3%A8%E4%B8%80%E8%A6%A7.md#19-%E3%82%B3%E3%83%BC%E3%83%89%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)で取得したコード.略称(ryaku_name)ではなく、コード.文字１(str1)を設定する
         - order1: 表示順１（昇順・降順）
         - sort_column2: 表示順２ソート対象カラム(指定する値は日本語カラム名（DBの物理カラム名）)  
            - 指定する値について、プルダウンにて表示している[19.コードマスタプルダウン](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/6.%E5%8F%97%E6%B3%A8%E4%B8%80%E8%A6%A7.md#19-%E3%82%B3%E3%83%BC%E3%83%89%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)で取得したコード.略称(ryaku_name)ではなく、コード.文字１(str1)を設定する
         - order2: 表示順２（昇順・降順）
         - sort_column3: 表示順３ソート対象カラム(指定する値は日本語カラム名（DBの物理カラム名）)  
            - 指定する値について、プルダウンにて表示している[19.コードマスタプルダウン](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/6.%E5%8F%97%E6%B3%A8%E4%B8%80%E8%A6%A7.md#19-%E3%82%B3%E3%83%BC%E3%83%89%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)で取得したコード.略称(ryaku_name)ではなく、コード.文字１(str1)を設定する
         - order3: 表示順３（昇順・降順）
         - page: ページ
         - size: 50(固定)
         - 各項目のマッピングは[受注シートの備考を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/schema/%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E8%A8%AD%E8%A8%88%E6%9B%B8.xlsx)
   2. 完了メッセージ表示  
      以下の完了メッセージをダイアログ表示する  
      -----  ここから  -----  
      CSV出力が完了しました。  
         ファイルパス：absolute_path(※1)  
         ファイル名　：file_name(※2)  
      -----  ここまで  -----  
      ※1：受注CSV作成APIからの戻り値のアップロード先のフルパス(absolute_path)  
      ※2：受注CSV作成APIからの戻り値のアップロードファイル名(file_name)  

## 19. コードマスタプルダウン
[こちらの仕様を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/3.%E5%95%86%E8%AB%87%E4%B8%80%E8%A6%A7.md#2-%E3%82%B3%E3%83%BC%E3%83%89%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)
- 補記
   - 物件状況: BKJK
   - 支払完了: SHKR
   - 表示順１: SORT
   - 表示順２: SORT
   - 表示順３: SORT

## 20. 管轄支店プルダウン
[こちらの仕様を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/3.%E5%95%86%E8%AB%87%E4%B8%80%E8%A6%A7.md#3-%E6%94%AF%E5%BA%97%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)

## 21. 担当部署プルダウン
[こちらの仕様を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/3.%E5%95%86%E8%AB%87%E4%B8%80%E8%A6%A7.md#4-%E9%83%A8%E7%BD%B2%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)

## 22. 担当者プルダウン
[こちらの仕様を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/3.%E5%95%86%E8%AB%87%E4%B8%80%E8%A6%A7.md#5-%E6%8B%85%E5%BD%93%E8%80%85%E3%83%97%E3%83%AB%E3%83%80%E3%82%A6%E3%83%B3)

## 23. 工事担当者オートコンプリート
[41.社員API](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/api/graphql/41.%E7%A4%BE%E5%93%A1.md)用いてプルダウンを生成  
#### リクエストパラメータ
```json
   getEmployees(
      request: {
         name: "...",
         sort_column1: "...",
         order1: "...",
      }
   )
```
- name: 入力された社員名
- sort_column1: "社員コード"
- order1: "asc"
- 社員APIで取得した情報一覧のうち、退職区分(retire_kind)が'1'以外のデータの後に退職区分(retire_kind)が'1'のデータを追加した並びで候補を表示  
  但し、「退職区分(retire_kind)」が'1'の社員については、社員名の先頭に'★'を追記  
- 各項目のマッピングは[社員シートの備考を参照](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/schema/%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E8%A8%AD%E8%A8%88%E6%9B%B8.xlsx)  
- 社員名が未設定('')だった場合は社員APIはコールしない。検索結果が501件以上になった場合、「ヒット件数が多すぎます。」のエラーメッセージを表示する  

## 24. ＡＢ手配登録
[9.ＡＢ手配](https://github.com/ljs-shimizu/tamada-coresystem-docs/blob/develop/spec/front/9.%EF%BC%A1%EF%BC%A2%E6%89%8B%E9%85%8D.md)に遷移  
※ＡＢ手配登録画面へ受注番号を引き継ぐ（ボタン押下行の受注番号）

