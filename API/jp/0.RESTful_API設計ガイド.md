# RESTful API設計ガイド

## 概要
このドキュメントは、社員管理システム全体で使用されるRESTful API設計原則と標準を説明します。

## RESTful API原則

### 1. リソースベースURL
- URLでは動詞ではなく名詞を使用
- コレクションには複数形の名詞を使用
- 関連リソースには階層構造を使用

**例:**
```
✅ 良い例:
GET /api/v1/employees
GET /api/v1/employees/{id}
GET /api/v1/employees/{id}/qualifications
GET /api/v1/departments/{id}/employees

❌ 悪い例:
GET /api/v1/getEmployees
GET /api/v1/employee/{id}/getQualifications
```

### 2. HTTPメソッド
異なる操作に適切なHTTPメソッドを使用:

| メソッド | 目的 | 例 |
|---------|------|-----|
| GET | リソース取得 | `GET /api/v1/employees` |
| POST | 新規リソース作成 | `POST /api/v1/employees` |
| PUT | リソース全体更新 | `PUT /api/v1/employees/{id}` |
| PATCH | 部分更新 | `PATCH /api/v1/employees/{id}` |
| DELETE | リソース削除 | `DELETE /api/v1/employees/{id}` |

### 3. HTTPステータスコード
適切なHTTPステータスコードを使用:

| コード | 意味 | 使用場面 |
|-------|------|----------|
| 200 | OK | 成功したGET、PUT、PATCH |
| 201 | Created | 成功したPOST |
| 204 | No Content | 成功したDELETE |
| 400 | Bad Request | 無効なリクエストデータ |
| 401 | Unauthorized | 認証なしまたは無効 |
| 403 | Forbidden | 有効な認証だが権限不足 |
| 404 | Not Found | リソースが見つからない |
| 409 | Conflict | リソースが既に存在 |
| 422 | Unprocessable Entity | バリデーションエラー |
| 500 | Internal Server Error | サーバーエラー |

### 4. リクエスト/レスポンス形式

#### リクエストヘッダー
```
Content-Type: application/json
Authorization: Bearer {token}
Accept: application/json
```

#### レスポンス形式
```json
{
  "success": true,
  "data": { ... },
  "message": "操作が正常に完了しました",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 100,
    "totalPages": 5
  }
}
```

#### エラーレスポンス形式
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "入力データが無効です",
  "details": [
    {
      "field": "email",
      "message": "メールアドレスは必須です"
    }
  ]
}
```

### 5. クエリパラメータ
フィルタリング、ソート、ページネーションにクエリパラメータを使用:

```
GET /api/v1/employees?page=1&size=20&sort=name,asc&department=IT
GET /api/v1/employees?search=john&isActive=true
GET /api/v1/qualifications?type=technical&year=2024
```

### 6. ページネーション
すべてのリストエンドポイントで一貫したページネーションを実装:

```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 100,
    "totalPages": 5,
    "hasNext": true,
    "hasPrevious": false
  }
}
```

### 7. フィルタリングと検索
クエリパラメータでフィルタリングと検索をサポート:

```
# 部署でフィルタ
GET /api/v1/employees?department=IT

# 名前で検索
GET /api/v1/employees?search=john

# 複数フィルタ
GET /api/v1/employees?department=IT&isActive=true&hireDate=2024-01-01

# 日付範囲フィルタ
GET /api/v1/employees?hireDateFrom=2024-01-01&hireDateTo=2024-12-31
```

### 8. ソート
`sort`パラメータでソートをサポート:

```
# 単一フィールドソート
GET /api/v1/employees?sort=name

# 複数フィールドソート
GET /api/v1/employees?sort=department,name

# 降順
GET /api/v1/employees?sort=name,desc
```

### 9. APIバージョニング
APIバージョンにURLバージョニングを使用:

```
/api/v1/employees
/api/v2/employees
```

### 10. 認証
Bearer Token認証を使用:

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 11. レート制限
ヘッダーでレート制限を実装:

```
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1640995200
```

### 12. キャッシュ
適切なキャッシュヘッダーを使用:

```
Cache-Control: public, max-age=3600
ETag: "1234567890"
Last-Modified: Wed, 21 Oct 2024 07:28:00 GMT
```

## APIエンドポイント構造

### 社員管理
```
GET    /api/v1/employees              # 社員一覧
POST   /api/v1/employees              # 社員作成
GET    /api/v1/employees/{id}         # 社員取得
PUT    /api/v1/employees/{id}         # 社員更新
PATCH  /api/v1/employees/{id}         # 部分更新
DELETE /api/v1/employees/{id}         # 社員削除
```

### 部署管理
```
GET    /api/v1/departments            # 部署一覧
POST   /api/v1/departments            # 部署作成
GET    /api/v1/departments/{id}       # 部署取得
PUT    /api/v1/departments/{id}       # 部署更新
DELETE /api/v1/departments/{id}       # 部署削除
```

### 資格管理
```
GET    /api/v1/qualifications         # 資格一覧
POST   /api/v1/qualifications         # 資格作成
GET    /api/v1/qualifications/{id}    # 資格取得
PUT    /api/v1/qualifications/{id}    # 資格更新
DELETE /api/v1/qualifications/{id}    # 資格削除
```

### 年休管理
```
GET    /api/v1/annual-leaves          # 年休一覧
POST   /api/v1/annual-leaves          # 年休作成
GET    /api/v1/annual-leaves/{id}     # 年休取得
PUT    /api/v1/annual-leaves/{id}     # 年休更新
DELETE /api/v1/annual-leaves/{id}     # 年休削除
```

### 溶接免許管理
```
GET    /api/v1/welding-licenses       # 溶接免許一覧
POST   /api/v1/welding-licenses       # 溶接免許作成
GET    /api/v1/welding-licenses/{id}  # 溶接免許取得
PUT    /api/v1/welding-licenses/{id}  # 溶接免許更新
DELETE /api/v1/welding-licenses/{id}  # 溶接免許削除
```

## ベストプラクティス

### 1. 一貫した命名
- JSONプロパティにはcamelCaseを使用
- URLにはkebab-caseを使用
- 説明的な名前を使用

### 2. エラーハンドリング
- 常に適切なHTTPステータスコードを返す
- 意味のあるエラーメッセージを提供
- フィールドレベルのバリデーションエラーを含める

### 3. ドキュメント
- すべてのエンドポイントをドキュメント化
- リクエスト/レスポンス例を提供
- エラーシナリオを含める

### 4. セキュリティ
- すべての入力データをバリデーション
- 本番環境ではHTTPSを使用
- 適切な認証を実装
- ユーザー入力をサニタイズ

### 5. パフォーマンス
- 大きなデータセットにはページネーションを実装
- 適切なHTTPキャッシュを使用
- データベースクエリを最適化
- APIレート制限を考慮

## 実装例

### 完全なCRUD例
```javascript
// 社員作成
POST /api/v1/employees
{
  "employeeCode": "EMP001",
  "fullName": "田中太郎",
  "department": "IT",
  "hireDate": "2024-01-15"
}

// レスポンス
{
  "success": true,
  "data": {
    "id": 1,
    "employeeCode": "EMP001",
    "fullName": "田中太郎",
    "department": "IT",
    "hireDate": "2024-01-15",
    "createdAt": "2024-01-15T10:30:00Z"
  },
  "message": "社員が正常に作成されました"
}

// 社員取得
GET /api/v1/employees/1

// 社員更新
PUT /api/v1/employees/1
{
  "employeeCode": "EMP001",
  "fullName": "田中花子",
  "department": "IT",
  "hireDate": "2024-01-15"
}

// 社員削除
DELETE /api/v1/employees/1
```

---

*このガイドは社員管理システム全体で一貫したRESTful API設計を保証します*
