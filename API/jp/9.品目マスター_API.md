# 9. 品目マスターAPI

**バージョン:** v0.1  
**最終更新:** 2025-10-25  
**作成者:** Chính  
**レビュー担当:** [PM/Leader Name]  
**システム:** 人事管理  

---

## 1. 概要
作業服商品カタログを管理するAPI（品目マスター）- 商品情報、サイズ、色、価格を管理します。

**データベーステーブル:** `T_品目マスター`（作成が必要）

---

## 2. エンドポイント

### 2.1. 商品リスト取得
- **API Call:** `GET /api/v1/items`
- **説明:** すべての作業服商品のリストを取得
- **クエリパラメータ:**
  - `page` (number, optional): ページ番号（デフォルト: 1）
  - `size` (number, optional): ページサイズ（デフォルト: 20、最大: 100）
  - `search` (string, optional): 商品名で検索
  - `category` (string, optional): カテゴリでフィルタ
  - `isActive` (boolean, optional): 有効ステータスでフィルタ
  - `sort` (string, optional): ソート順（デフォルト: itemName,asc）

**Response Data Type:**
```typescript
interface Item {
  itemCode: string;
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}

interface ItemListResponse {
  success: true;
  data: Item[];
  message: "商品リストの取得に成功しました";
  pagination: {
    page: number;
    size: number;
    totalElements: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

**Example Response:**
```json
{
  "success": true,
  "data": [
    {
      "itemCode": "UF001",
      "itemName": "作業服 上下セット",
      "category": "作業服",
      "description": "標準的な作業服上下セット",
      "availableSizes": ["S", "M", "L", "XL", "XXL"],
      "availableColors": ["ネイビー", "グレー", "ブラック"],
      "unitPrice": 75000,
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    },
    {
      "itemCode": "UF002",
      "itemName": "安全靴",
      "category": "靴",
      "description": "安全基準準拠の作業靴",
      "availableSizes": ["24", "25", "26", "27", "28", "29", "30"],
      "availableColors": ["ブラック", "ブラウン"],
      "unitPrice": 25000,
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "message": "商品リストの取得に成功しました",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 2,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

### 2.2. 商品コードによる商品取得
- **API Call:** `GET /api/v1/items/{itemCode}`
- **説明:** 商品の詳細情報を取得
- **パスパラメータ:**
  - `itemCode` (string, required): 商品コード

**Response Data Type:**
```typescript
interface ItemDetailResponse {
  success: true;
  data: Item;
  message: "商品の詳細取得に成功しました";
}
```

### 2.3. 新規商品作成
- **API Call:** `POST /api/v1/items`
- **説明:** 新しい作業服商品を作成
- **Request Data Type:**
```typescript
interface CreateItemRequest {
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive?: boolean;
}
```

**Response Data Type:**
```typescript
interface CreateItemResponse {
  success: true;
  data: Item;
  message: "商品の作成に成功しました";
}
```

### 2.4. 商品更新
- **API Call:** `PUT /api/v1/items/{itemCode}`
- **説明:** 商品情報を更新
- **パスパラメータ:**
  - `itemCode` (string, required): 商品コード
- **Request Data Type:**
```typescript
interface UpdateItemRequest {
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive: boolean;
}
```

**Response Data Type:**
```typescript
interface UpdateItemResponse {
  success: true;
  data: Item;
  message: "商品の更新に成功しました";
}
```

### 2.5. 商品削除
- **API Call:** `DELETE /api/v1/items/{itemCode}`
- **説明:** 商品を削除（ソフト削除）
- **パスパラメータ:**
  - `itemCode` (string, required): 商品コード

**Response Data Type:**
```typescript
interface DeleteItemResponse {
  success: true;
  data: null;
  message: "商品の削除に成功しました";
}
```

### 2.6. 商品ステータス更新
- **API Call:** `PATCH /api/v1/items/{itemCode}/status`
- **説明:** 商品の有効ステータスを更新
- **パスパラメータ:**
  - `itemCode` (string, required): 商品コード
- **Request Data Type:**
```typescript
interface UpdateItemStatusRequest {
  isActive: boolean;
}
```

---

## 3. エラーレスポンス

### 3.1. バリデーションエラー
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "code": "ITEM_001",
  "message": "入力データが無効です",
  "details": [
    {
      "field": "itemName",
      "message": "商品名は必須です",
      "code": "FIELD_REQUIRED"
    },
    {
      "field": "unitPrice",
      "message": "単価は0より大きい必要があります",
      "code": "INVALID_PRICE"
    }
  ]
}
```

### 3.2. 見つからないエラー
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "code": "ITEM_002",
  "message": "商品が見つかりません",
  "details": []
}
```

### 3.3. 競合エラー
```json
{
  "success": false,
  "error": "CONFLICT",
  "code": "ITEM_003",
  "message": "商品コードが既に存在します",
  "details": []
}
```

---

## 4. ビジネスルール

### 4.1. バリデーションルール
- **itemCode:** 自動生成、フォーマット: UF + 3桁（UF001, UF002...）
- **itemName:** 必須、最大100文字
- **category:** 必須、最大50文字
- **unitPrice:** 必須、0より大きい必要があります
- **availableSizes:** 必須、少なくとも1つのサイズ
- **availableColors:** 必須、少なくとも1つの色

### 4.2. 制約
- 注文で使用中の商品は削除できません
- ソフト削除: ハード削除の代わりに`isActive = false`を設定
- 商品名はカテゴリ内で一意である必要があります

### 4.3. 権限
- **hr:read:** 商品リストと詳細の表示
- **hr:write:** 商品の作成、更新
- **hr:admin:** 商品の削除、ステータス更新

---

## 5. データベーススキーマ

### 5.1. テーブル構造
```sql
CREATE TABLE T_品目マスター (
    商品コード VARCHAR2(50 CHAR) PRIMARY KEY,
    商品名 VARCHAR2(100 CHAR),
    カテゴリ VARCHAR2(50 CHAR),
    説明 VARCHAR2(255 CHAR),
    利用可能サイズ CLOB, -- JSON array of sizes
    利用可能色 CLOB,     -- JSON array of colors
    単価 NUMBER(10, 2),
    有効フラグ NUMBER(1) DEFAULT 1,
    作成日時 TIMESTAMP,
    更新日時 TIMESTAMP
);

-- 商品コード自動生成用シーケンス
CREATE SEQUENCE SEQ_品目マスター_コード
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;
```

### 5.2. インデックス
- `IDX_品目マスター_商品名` on `T_品目マスター(商品名)`
- `IDX_品目マスター_カテゴリ` on `T_品目マスター(カテゴリ)`
- `IDX_品目マスター_有効フラグ` on `T_品目マスター(有効フラグ)`

---

## 6. パフォーマンス考慮事項

### 6.1. キャッシング
- 商品リストを1時間キャッシュ
- 変更時にキャッシュを無効化

### 6.2. ページネーション
- デフォルト20アイテム/ページ
- 最大100アイテム/ページ
- Oracle用にOFFSET/LIMITを使用

---

## 7. テストシナリオ

### 7.1. ハッピーパス
1. 商品リストの取得に成功
2. 新規商品の作成に成功
3. 商品の更新に成功
4. 商品ステータスの更新に成功

### 7.2. エラーケース
1. 重複名で商品を作成
2. 存在しない商品を更新
3. 注文で使用中の商品を削除
4. 必須フィールドが不足している場合のバリデーションエラー

---

*このAPIはRESTfulルールとREADME.mdの標準に従います*
