# 2. 部署 API
**バージョン:** v0.1  
**最終更新日:** 2025-10-25  
**作成者:** Chinh  
**レビュー担当:** [PM/Leader Name]  
**システム:** 人事管理システム  

---

## 概要
統括部門（T_統括部門）と部署名（T_部署名）を含む部署データを管理するAPIです。階層的な部署管理機能を提供します。

## ベースURL
`/api/v1/departments`

## 認証
すべてのエンドポイントでBearer Tokenが必要です

## データモデル

### 統括部門エンティティ
```json
{
  "divisionId": "number",        // 部門ID (主キー)
  "divisionName": "string",      // 統括部門
  "field1": "string"             // フィールド1
}
```

### 部署エンティティ
```json
{
  "departmentId": "string",      // 部署ID (主キー)
  "divisionId": "number",        // 部門ID (外部キー)
  "departmentName": "string"     // 部署名
}
```

## エンドポイント

### 1. 全統括部門取得
**GET** `/api/v1/departments/divisions`

#### レスポンス
```json
{
  "data": [
    {
      "divisionId": 1,
      "divisionName": "営業部",
      "field1": "営業関連"
    },
    {
      "divisionId": 2,
      "divisionName": "技術部",
      "field1": "技術関連"
    }
  ]
}
```

### 2. 統括部門作成
**POST** `/api/v1/departments/divisions`

#### リクエストボディ
```json
{
  "divisionName": "人事部",
  "field1": "人事関連"
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "統括部門が正常に作成されました",
  "data": {
    "divisionId": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 3. 統括部門更新
**PUT** `/api/v1/departments/divisions/{divisionId}`

#### パスパラメータ
- `divisionId`: 部門ID

#### リクエストボディ
```json
{
  "divisionName": "営業企画部",
  "field1": "営業企画関連"
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "統括部門が正常に更新されました",
  "data": {
    "divisionId": 1,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 4. 統括部門削除
**DELETE** `/api/v1/departments/divisions/{divisionId}`

#### パスパラメータ
- `divisionId`: 部門ID

#### レスポンス
```json
{
  "success": true,
  "message": "統括部門が正常に削除されました"
}
```

### 5. 全部署取得
**GET** `/api/v1/departments`

#### クエリパラメータ
- `divisionId` (任意): 部門IDでフィルタ
- `page` (任意): ページ番号 (デフォルト: 1)
- `size` (任意): ページサイズ (デフォルト: 20)

#### レスポンス
```json
{
  "data": [
    {
      "departmentId": "DEPT001",
      "divisionId": 1,
      "departmentName": "営業一課",
      "divisionName": "営業部"
    },
    {
      "departmentId": "DEPT002",
      "divisionId": 1,
      "departmentName": "営業二課",
      "divisionName": "営業部"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 50,
    "totalPages": 3
  }
}
```

### 6. 部署IDで部署取得
**GET** `/api/v1/departments/{departmentId}`

#### パスパラメータ
- `departmentId`: 部署ID

#### レスポンス
```json
{
  "data": {
    "departmentId": "DEPT001",
    "divisionId": 1,
    "departmentName": "営業一課",
    "divisionName": "営業部"
  }
}
```

### 7. 部署作成
**POST** `/api/v1/departments`

#### リクエストボディ
```json
{
  "departmentId": "DEPT003",
  "divisionId": 2,
  "departmentName": "開発一課"
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "部署が正常に作成されました",
  "data": {
    "departmentId": "DEPT003",
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 8. 部署更新
**PUT** `/api/v1/departments/{departmentId}`

#### パスパラメータ
- `departmentId`: 部署ID

#### リクエストボディ
```json
{
  "divisionId": 2,
  "departmentName": "開発企画課"
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "部署が正常に更新されました",
  "data": {
    "departmentId": "DEPT003",
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 9. 部署削除
**DELETE** `/api/v1/departments/{departmentId}`

#### パスパラメータ
- `departmentId`: 部署ID

#### レスポンス
```json
{
  "success": true,
  "message": "部署が正常に削除されました"
}
```

### 10. 部門別部署取得
**GET** `/api/v1/departments/by-division/{divisionId}`

#### パスパラメータ
- `divisionId`: 部門ID

#### レスポンス
```json
{
  "data": [
    {
      "departmentId": "DEPT001",
      "departmentName": "営業一課"
    },
    {
      "departmentId": "DEPT002",
      "departmentName": "営業二課"
    }
  ]
}
```

### 11. 部署階層取得
**GET** `/api/v1/departments/hierarchy`

#### レスポンス
```json
{
  "data": [
    {
      "divisionId": 1,
      "divisionName": "営業部",
      "field1": "営業関連",
      "departments": [
        {
          "departmentId": "DEPT001",
          "departmentName": "営業一課"
        },
        {
          "departmentId": "DEPT002",
          "departmentName": "営業二課"
        }
      ]
    },
    {
      "divisionId": 2,
      "divisionName": "技術部",
      "field1": "技術関連",
      "departments": [
        {
          "departmentId": "DEPT003",
          "departmentName": "開発一課"
        }
      ]
    }
  ]
}
```

## エラーレスポンス

### 400 Bad Request
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "入力データが無効です",
  "details": [
    {
      "field": "departmentName",
      "message": "部署名は必須です"
    }
  ]
}
```

### 404 Not Found
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "message": "部署が見つかりません"
}
```

### 409 Conflict
```json
{
  "success": false,
  "error": "CONFLICT",
  "message": "部署IDが既に存在します"
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": "INTERNAL_ERROR",
  "message": "予期しないエラーが発生しました"
}
```

## ビジネスルール

1. **部署ID**: すべての部署間で一意である必要があります
2. **部門ID**: 既存の統括部門を参照する必要があります
3. **カスケード削除**: 統括部門を削除する際は関連する部署を適切に処理する必要があります
4. **名前検証**: 部署名と部門名は空にできません
5. **階層検証**: 部署は有効な部門に属している必要があります

## データベース制約

- 主キー: `部門ID`, `部署ID`
- 外部キー: `T_部署名.部門ID` → `T_統括部門.部門ID`
- 部署IDの一意制約
- 名前検証のチェック制約

## 使用例

### 部署階層を取得
```bash
curl -X GET "https://api.company.com/api/v1/departments/hierarchy" \
  -H "Authorization: Bearer your-token"
```

### 新しい部署を作成
```bash
curl -X POST "https://api.company.com/api/v1/departments" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "departmentId": "DEPT004",
    "divisionId": 1,
    "departmentName": "営業三課"
  }'
```

### 部門別部署を取得
```bash
curl -X GET "https://api.company.com/api/v1/departments/by-division/1" \
  -H "Authorization: Bearer your-token"
```

---

*このAPIドキュメントは社員管理システムの一部です*
