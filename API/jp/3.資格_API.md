# 3. 資格 API
**バージョン:** v0.1  
**最終更新日:** 2025-10-25  
**作成者:** Chinh  
**レビュー担当:** [PM/Leader Name]  
**システム:** 人事管理システム  

---

## 概要
資格手当（T_資格手当）と社員資格（T_資格）を含む資格データを管理するAPIです。包括的な資格管理機能を提供します。

## ベースURL
`/api/v1/qualifications`

## 認証
すべてのエンドポイントでBearer Tokenが必要です

## データモデル

### 資格手当エンティティ
```json
{
  "qualificationId": "number",        // 資格ID (主キー)
  "name": "string",                   // 名称
  "grade": "string",                  // 等級
  "type": "string",                   // 種類
  "amount": "number",                 // 金額
  "remarks": "string"                 // 備考
}
```

### 社員資格エンティティ
```json
{
  "id": "number",                     // ID (主キー)
  "employeeCode": "string",           // 社員コード (外部キー)
  "name": "string",                   // 名称
  "grade": "string",                  // 等級
  "type": "string",                   // 種類
  "amount": "number",                 // 金額
  "isChecked": "boolean",             // チェック
  "certificateNumber": "string",      // 番号
  "acquisitionDate": "date",          // 取得日
  "qualificationTypeId": "number"     // 資格ID (外部キー)
}
```

## エンドポイント

### 1. 全資格手当取得
**GET** `/api/v1/qualifications/allowances`

#### クエリパラメータ
- `page` (任意): ページ番号 (デフォルト: 1)
- `size` (任意): ページサイズ (デフォルト: 20)
- `name` (任意): 資格名でフィルタ
- `type` (任意): 資格種別でフィルタ

#### レスポンス
```json
{
  "data": [
    {
      "qualificationId": 1,
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "remarks": "IT関連の基本資格"
    },
    {
      "qualificationId": 2,
      "name": "応用情報技術者",
      "grade": "応用",
      "type": "国家資格",
      "amount": 8000.00,
      "remarks": "IT関連の応用資格"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 50,
    "totalPages": 3
  }
}
```

### 2. 資格手当IDで取得
**GET** `/api/v1/qualifications/allowances/{qualificationId}`

#### パスパラメータ
- `qualificationId`: 資格ID

#### レスポンス
```json
{
  "data": {
    "qualificationId": 1,
    "name": "基本情報技術者",
    "grade": "基本",
    "type": "国家資格",
    "amount": 5000.00,
    "remarks": "IT関連の基本資格"
  }
}
```

### 3. 資格手当作成
**POST** `/api/v1/qualifications/allowances`

#### リクエストボディ
```json
{
  "name": "データベーススペシャリスト",
  "grade": "専門",
  "type": "国家資格",
  "amount": 10000.00,
  "remarks": "データベース専門資格"
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "資格手当が正常に作成されました",
  "data": {
    "qualificationId": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 4. 資格手当更新
**PUT** `/api/v1/qualifications/allowances/{qualificationId}`

#### パスパラメータ
- `qualificationId`: 資格ID

#### リクエストボディ
```json
{
  "name": "データベーススペシャリスト（更新）",
  "grade": "専門",
  "type": "国家資格",
  "amount": 12000.00,
  "remarks": "データベース専門資格（更新）"
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "資格手当が正常に更新されました",
  "data": {
    "qualificationId": 3,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 5. 資格手当削除
**DELETE** `/api/v1/qualifications/allowances/{qualificationId}`

#### パスパラメータ
- `qualificationId`: 資格ID

#### レスポンス
```json
{
  "success": true,
  "message": "資格手当が正常に削除されました"
}
```

### 6. 社員資格取得
**GET** `/api/v1/qualifications/employees/{employeeCode}`

#### パスパラメータ
- `employeeCode`: 社員コード

#### クエリパラメータ
- `year` (任意): 取得年でフィルタ
- `type` (任意): 資格種別でフィルタ

#### レスポンス
```json
{
  "data": [
    {
      "id": 1,
      "employeeCode": "EMP001",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "isChecked": true,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    },
    {
      "id": 2,
      "employeeCode": "EMP001",
      "name": "応用情報技術者",
      "grade": "応用",
      "type": "国家資格",
      "amount": 8000.00,
      "isChecked": false,
      "certificateNumber": "AP2024001",
      "acquisitionDate": "2024-06-20",
      "qualificationTypeId": 2
    }
  ]
}
```

### 7. 社員資格作成
**POST** `/api/v1/qualifications/employees`

#### リクエストボディ
```json
{
  "employeeCode": "EMP001",
  "name": "データベーススペシャリスト",
  "grade": "専門",
  "type": "国家資格",
  "amount": 10000.00,
  "isChecked": true,
  "certificateNumber": "DB2024001",
  "acquisitionDate": "2024-09-10",
  "qualificationTypeId": 3
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "社員資格が正常に作成されました",
  "data": {
    "id": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 8. 社員資格更新
**PUT** `/api/v1/qualifications/employees/{id}`

#### パスパラメータ
- `id`: 資格記録ID

#### リクエストボディ
```json
{
  "name": "データベーススペシャリスト（更新）",
  "grade": "専門",
  "type": "国家資格",
  "amount": 12000.00,
  "isChecked": true,
  "certificateNumber": "DB2024001",
  "acquisitionDate": "2024-09-10",
  "qualificationTypeId": 3
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "社員資格が正常に更新されました",
  "data": {
    "id": 3,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 9. 社員資格削除
**DELETE** `/api/v1/qualifications/employees/{id}`

#### パスパラメータ
- `id`: 資格記録ID

#### レスポンス
```json
{
  "success": true,
  "message": "社員資格が正常に削除されました"
}
```

### 10. 資格統計取得
**GET** `/api/v1/qualifications/statistics`

#### クエリパラメータ
- `divisionId` (任意): 部門でフィルタ
- `departmentId` (任意): 部署でフィルタ
- `year` (任意): 年でフィルタ

#### レスポンス
```json
{
  "data": {
    "totalQualifications": 150,
    "qualificationsByType": [
      {
        "type": "国家資格",
        "count": 80,
        "percentage": 53.3
      },
      {
        "type": "民間資格",
        "count": 70,
        "percentage": 46.7
      }
    ],
    "qualificationsByGrade": [
      {
        "grade": "基本",
        "count": 60,
        "percentage": 40.0
      },
      {
        "grade": "応用",
        "count": 50,
        "percentage": 33.3
      },
      {
        "grade": "専門",
        "count": 40,
        "percentage": 26.7
      }
    ],
    "totalAllowanceAmount": 750000.00
  }
}
```

### 11. 資格検索
**GET** `/api/v1/qualifications/search`

#### クエリパラメータ
- `keyword` (必須): 検索キーワード
- `type` (任意): 資格種別でフィルタ
- `grade` (任意): 等級でフィルタ
- `employeeCode` (任意): 社員でフィルタ

#### レスポンス
```json
{
  "data": [
    {
      "id": 1,
      "employeeCode": "EMP001",
      "employeeName": "田中太郎",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "acquisitionDate": "2024-03-15"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 25,
    "totalPages": 2
  }
}
```

### 12. 資格一括インポート
**POST** `/api/v1/qualifications/import`

#### リクエストボディ
```json
{
  "qualifications": [
    {
      "employeeCode": "EMP001",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    },
    {
      "employeeCode": "EMP002",
      "name": "応用情報技術者",
      "grade": "応用",
      "type": "国家資格",
      "amount": 8000.00,
      "certificateNumber": "AP2024002",
      "acquisitionDate": "2024-04-20",
      "qualificationTypeId": 2
    }
  ]
}
```

#### レスポンス
```json
{
  "success": true,
  "message": "資格が正常にインポートされました",
  "data": {
    "importedCount": 2,
    "failedCount": 0,
    "errors": []
  }
}
```

## エラーレスポンス

### 400 Bad Request
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "入力データが無効です",
  "details": [
    {
      "field": "name",
      "message": "資格名は必須です"
    }
  ]
}
```

### 404 Not Found
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "message": "資格が見つかりません"
}
```

### 409 Conflict
```json
{
  "success": false,
  "error": "CONFLICT",
  "message": "この社員の資格は既に存在します"
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": "INTERNAL_ERROR",
  "message": "予期しないエラーが発生しました"
}
```

## ビジネスルール

1. **資格手当**: 名前と等級の組み合わせで一意である必要があります
2. **社員資格**: 社員コードは既存の社員を参照する必要があります
3. **金額検証**: 金額は正の数である必要があります
4. **日付検証**: 取得日は未来の日付にできません
5. **証明書番号**: 同じ資格種別内で一意である必要があります
6. **チェック状態**: 取得日が設定されている場合のみtrueにできます

## データベース制約

- 主キー: `資格ID`, `ID`
- 外部キー: 
  - `T_資格.社員コード` → `T_社員マスタ.社員コード`
  - `T_資格.資格ID` → `T_資格手当.資格ID`
- 証明書番号の一意制約
- 金額検証のチェック制約

## 使用例

### 特定社員の資格取得
```bash
curl -X GET "https://api.company.com/api/v1/qualifications/employees/EMP001" \
  -H "Authorization: Bearer your-token"
```

### 新しい資格手当作成
```bash
curl -X POST "https://api.company.com/api/v1/qualifications/allowances" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "新資格",
    "grade": "基本",
    "type": "国家資格",
    "amount": 5000.00,
    "remarks": "新しい資格"
  }'
```

### 資格検索
```bash
curl -X GET "https://api.company.com/api/v1/qualifications/search?keyword=情報技術" \
  -H "Authorization: Bearer your-token"
```

---

*このAPIドキュメントは社員管理システムの一部です*
