# 7. 資格手当API

**バージョン:** v0.1  
**最終更新:** 2025-10-25  
**作成者:** Chính  
**レビュー担当:** [PM/Leader Name]  
**システム:** 人事管理  

---

## 1. 概要
資格手当（資格手当）を管理するAPI - 資格手当タイプのマスタテーブル。

**データベーステーブル:** `T_資格手当`

---

## 2. エンドポイント

### 2.1. 資格手当リスト取得
- **API Call:** `GET /api/v1/qualification-allowances`
- **説明:** すべての資格手当のリストを取得
- **クエリパラメータ:**
  - `page` (number, optional): ページ番号（デフォルト: 1）
  - `size` (number, optional): ページサイズ（デフォルト: 20、最大: 100）
  - `search` (string, optional): 資格名で検索
  - `type` (string, optional): 資格タイプでフィルタ
  - `grade` (string, optional): 等級でフィルタ
  - `sort` (string, optional): ソート順（デフォルト: name,asc）

**Response Data Type:**
```typescript
interface QualificationAllowance {
  qualificationId: number;
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
  createdAt: string;
  updatedAt: string;
}

interface QualificationAllowanceListResponse {
  success: true;
  data: QualificationAllowance[];
  message: "資格手当リストの取得に成功しました";
  pagination: {
    page: number;
    size: number;
    totalElements: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

**Example Response:**
```json
{
  "success": true,
  "data": [
    {
      "qualificationId": 1,
      "name": "機械エンジニア資格",
      "grade": "1級",
      "type": "技術",
      "allowanceAmount": 500000,
      "remarks": "月額手当",
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    },
    {
      "qualificationId": 2,
      "name": "労働安全資格",
      "grade": "2級",
      "type": "安全",
      "allowanceAmount": 300000,
      "remarks": "月額手当",
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "message": "資格手当リストの取得に成功しました",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 2,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

### 2.2. IDによる資格手当取得
- **API Call:** `GET /api/v1/qualification-allowances/{qualificationId}`
- **説明:** 資格手当の詳細情報を取得
- **パスパラメータ:**
  - `qualificationId` (number, required): 資格手当ID

**Response Data Type:**
```typescript
interface QualificationAllowanceDetailResponse {
  success: true;
  data: QualificationAllowance;
  message: "資格手当の詳細取得に成功しました";
}
```

### 2.3. 新規資格手当作成
- **API Call:** `POST /api/v1/qualification-allowances`
- **説明:** 新しい資格手当を作成
- **Request Data Type:**
```typescript
interface CreateQualificationAllowanceRequest {
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
}
```

**Response Data Type:**
```typescript
interface CreateQualificationAllowanceResponse {
  success: true;
  data: QualificationAllowance;
  message: "資格手当の作成に成功しました";
}
```

### 2.4. 資格手当更新
- **API Call:** `PUT /api/v1/qualification-allowances/{qualificationId}`
- **説明:** 資格手当情報を更新
- **パスパラメータ:**
  - `qualificationId` (number, required): 資格手当ID
- **Request Data Type:**
```typescript
interface UpdateQualificationAllowanceRequest {
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
}
```

**Response Data Type:**
```typescript
interface UpdateQualificationAllowanceResponse {
  success: true;
  data: QualificationAllowance;
  message: "資格手当の更新に成功しました";
}
```

### 2.5. 資格手当削除
- **API Call:** `DELETE /api/v1/qualification-allowances/{qualificationId}`
- **説明:** 資格手当を削除（ソフト削除）
- **パスパラメータ:**
  - `qualificationId` (number, required): 資格手当ID

**Response Data Type:**
```typescript
interface DeleteQualificationAllowanceResponse {
  success: true;
  data: null;
  message: "資格手当の削除に成功しました";
}
```

---

## 3. エラーレスポンス

### 3.1. バリデーションエラー
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "code": "QA_001",
  "message": "入力データが無効です",
  "details": [
    {
      "field": "name",
      "message": "資格名は必須です",
      "code": "FIELD_REQUIRED"
    },
    {
      "field": "allowanceAmount",
      "message": "手当金額は0より大きい必要があります",
      "code": "INVALID_AMOUNT"
    }
  ]
}
```

### 3.2. 見つからないエラー
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "code": "QA_002",
  "message": "資格手当が見つかりません",
  "details": []
}
```

### 3.3. 競合エラー
```json
{
  "success": false,
  "error": "CONFLICT",
  "code": "QA_003",
  "message": "資格名が既に存在します",
  "details": []
}
```

---

## 4. ビジネスルール

### 4.1. バリデーションルール
- **name:** 必須、最大100文字
- **grade:** 必須、最大50文字
- **type:** 必須、最大50文字
- **allowanceAmount:** 必須、0より大きい必要があります
- **remarks:** オプション、最大255文字
- **資格名:** システム内で一意である必要があります

### 4.2. 制約
- 社員が使用中の資格手当は削除できません
- ソフト削除: ハード削除の代わりに`deletedAt`を設定

### 4.3. 権限
- **hr:read:** リストと詳細の表示
- **hr:write:** 資格手当の作成、更新
- **hr:admin:** 資格手当の削除

---

## 5. データベーススキーマ

### 5.1. テーブル構造
```sql
CREATE TABLE T_資格手当 (
    資格ID NUMBER(10) PRIMARY KEY,
    名称 VARCHAR2(100 CHAR),
    等級 VARCHAR2(50 CHAR),
    種類 VARCHAR2(50 CHAR),
    金額 NUMBER(10, 2),
    備考 VARCHAR2(255 CHAR)
);
```

### 5.2. インデックス
- `IDX_資格手当_名称` on `T_資格手当(名称)`
- `IDX_資格手当_種類` on `T_資格手当(種類)`

---

## 6. パフォーマンス考慮事項

### 6.1. キャッシング
- 資格手当リストを30分キャッシュ
- 変更時にキャッシュを無効化

### 6.2. ページネーション
- デフォルト20アイテム/ページ
- 最大100アイテム/ページ
- Oracle用にOFFSET/LIMITを使用

---

## 7. テストシナリオ

### 7.1. ハッピーパス
1. 資格手当リストの取得に成功
2. 新規資格手当の作成に成功
3. 資格手当情報の更新に成功
4. 資格手当の削除に成功

### 7.2. エラーケース
1. 重複名で資格手当を作成
2. 存在しない資格手当を更新
3. 社員が使用中の資格手当を削除
4. 必須フィールドが不足している場合のバリデーションエラー

---

*このAPIはRESTfulルールとREADME.mdの標準に従います*
