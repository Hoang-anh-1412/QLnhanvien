# 1. API Nhân Viên Chính
**Phiên bản:** v0.1  
**Ngày cập nhật:** 2025-10-25  
**Người biên soạn:** Chính  
**Người kiểm duyệt:** [PM/Leader Name]  
**Hệ thống:** Quản lý Nhân sự  

---

## Tổng quan
API quản lý dữ liệu nhân viên chính (bảng T_社員マスタ). Cung cấp các thao tác CRUD cho thông tin nhân viên bao gồm thông tin cá nhân, thông tin công việc và quản lý nghỉ phép.

## URL cơ sở
`/api/v1/employees`

## Xác thực
Tất cả các endpoint đều yêu cầu Bearer Token

## Nguyên tắc Thiết kế RESTful API
- **URL dựa trên Resource**: Sử dụng danh từ, không phải động từ
- **HTTP Methods**: GET, POST, PUT, DELETE, PATCH
- **Status Codes**: Mã trạng thái HTTP phù hợp
- **Stateless**: Mỗi request chứa tất cả thông tin cần thiết
- **Cacheable**: GET requests có thể cache
- **Uniform Interface**: Thiết kế API nhất quán trên tất cả resources

## Mô hình dữ liệu

### Thực thể Nhân viên
```json
{
  "employeeCode": "string",           // Mã nhân viên (Khóa chính)
  "divisionName": "string",           // Tên bộ phận quản lý
  "departmentName": "string",         // Tên bộ phận
  "fullName": "string",               // Họ tên
  "kanaName": "string",               // Tên bằng Katakana
  "gender": "string",                 // Giới tính
  "dateOfBirth": "date",              // Ngày sinh
  "hireDate": "date",                 // Ngày vào làm
  "seniorityBaseDate": "date",        // Ngày chuẩn tính thâm niên
  "resignationDate": "date",          // Ngày nghỉ việc
  "postalCode1": "string",            // Mã bưu điện 1
  "address1": "string",               // Địa chỉ 1
  "buildingName1": "string",          // Tên tòa nhà 1
  "phone1": "string",                 // Điện thoại 1
  "mobilePhone": "string",            // Điện thoại di động
  "postalCode2": "string",            // Mã bưu điện 2
  "address2": "string",               // Địa chỉ 2
  "phone2": "string",                 // Điện thoại 2
  "buildingName2": "string",          // Tên tòa nhà 2
  "weddingAnniversary": "date",       // Ngày kỷ niệm cưới
  "seniorityBaseYear": "number",      // Năm chuẩn tính thâm niên
  "annualLeaveGranted": "number",     // Số ngày phép được cấp năm nay
  "annualLeaveCarriedOver": "number", // Số ngày phép năm trước chuyển sang
  "totalAnnualLeave": "number",       // Tổng ngày nghỉ phép
  "annualLeaveUsed": "number",        // Số ngày phép đã sử dụng
  "remainingLeave": "number",         // Số ngày phép còn lại
  "summerVacation1": "date",          // Ngày nghỉ hè 1
  "summerVacation5": "date",          // Ngày nghỉ hè 5
  "remarks": "string"                 // Ghi chú
}
```

## Các endpoint

### 1. Lấy tất cả nhân viên
**GET** `/api/v1/employees`

#### Tham số truy vấn
- `page` (tùy chọn): Số trang (mặc định: 1)
- `size` (tùy chọn): Kích thước trang (mặc định: 20)
- `divisionName` (tùy chọn): Lọc theo tên bộ phận quản lý
- `departmentName` (tùy chọn): Lọc theo tên bộ phận
- `isRetired` (tùy chọn): Lọc theo trạng thái nghỉ việc (true/false)
- `search` (tùy chọn): Tìm kiếm theo tên hoặc mã nhân viên

#### Phản hồi
```json
{
  "data": [
    {
      "employeeCode": "EMP001",
      "divisionName": "Bộ phận kinh doanh",
      "departmentName": "Phòng kinh doanh 1",
      "fullName": "Tanaka Taro",
      "kanaName": "タナカタロウ",
      "gender": "Nam",
      "dateOfBirth": "1990-05-15",
      "hireDate": "2015-04-01",
      "seniorityBaseDate": "2015-04-01",
      "resignationDate": null,
      "postalCode1": "100-0001",
      "address1": "Tokyo, Chiyoda-ku, Chiyoda",
      "buildingName1": "Tòa nhà mẫu 1F",
      "phone1": "03-1234-5678",
      "mobilePhone": "090-1234-5678",
      "postalCode2": "100-0002",
      "address2": "Tokyo, Chiyoda-ku, Marunouchi",
      "phone2": "03-2345-6789",
      "buildingName2": "Tòa nhà mẫu 2F",
      "weddingAnniversary": "2018-06-15",
      "seniorityBaseYear": 2015,
      "annualLeaveGranted": 20.0,
      "annualLeaveCarriedOver": 5.0,
      "totalAnnualLeave": 25.0,
      "annualLeaveUsed": 10.0,
      "remainingLeave": 15.0,
      "summerVacation1": "2024-08-10",
      "summerVacation5": "2024-08-14",
      "remarks": "Không có ghi chú đặc biệt"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 100,
    "totalPages": 5
  }
}
```

### 2. Lấy nhân viên theo mã
**GET** `/api/v1/employees/{employeeCode}`

#### Tham số đường dẫn
- `employeeCode`: Mã nhân viên

#### Phản hồi
```json
{
  "data": {
    "employeeCode": "EMP001",
    "divisionName": "Bộ phận kinh doanh",
    "departmentName": "Phòng kinh doanh 1",
    "fullName": "Tanaka Taro",
    "kanaName": "タナカタロウ",
    "gender": "Nam",
    "dateOfBirth": "1990-05-15",
    "hireDate": "2015-04-01",
    "seniorityBaseDate": "2015-04-01",
    "resignationDate": null,
    "postalCode1": "100-0001",
    "address1": "Tokyo, Chiyoda-ku, Chiyoda",
    "buildingName1": "Tòa nhà mẫu 1F",
    "phone1": "03-1234-5678",
    "mobilePhone": "090-1234-5678",
    "postalCode2": "100-0002",
    "address2": "Tokyo, Chiyoda-ku, Marunouchi",
    "phone2": "03-2345-6789",
    "buildingName2": "Tòa nhà mẫu 2F",
    "weddingAnniversary": "2018-06-15",
    "seniorityBaseYear": 2015,
    "annualLeaveGranted": 20.0,
    "annualLeaveCarriedOver": 5.0,
    "totalAnnualLeave": 25.0,
    "annualLeaveUsed": 10.0,
    "remainingLeave": 15.0,
    "summerVacation1": "2024-08-10",
    "summerVacation5": "2024-08-14",
    "remarks": "Không có ghi chú đặc biệt"
  }
}
```

### 3. Tạo nhân viên
**POST** `/api/v1/employees`

#### Nội dung yêu cầu
```json
{
  "employeeCode": "EMP002",
  "divisionName": "Bộ phận kinh doanh",
  "departmentName": "Phòng kinh doanh 2",
  "fullName": "Sato Hanako",
  "kanaName": "サトウハナコ",
  "gender": "Nữ",
  "dateOfBirth": "1992-08-20",
  "hireDate": "2017-04-01",
  "seniorityBaseDate": "2017-04-01",
  "resignationDate": null,
  "postalCode1": "150-0001",
  "address1": "Tokyo, Shibuya-ku, Jingumae",
  "buildingName1": "Căn hộ mẫu 101",
  "phone1": "03-3456-7890",
  "mobilePhone": "090-2345-6789",
  "postalCode2": "",
  "address2": "",
  "phone2": "",
  "buildingName2": "",
  "weddingAnniversary": null,
  "seniorityBaseYear": 2017,
  "annualLeaveGranted": 18.0,
  "annualLeaveCarriedOver": 0.0,
  "totalAnnualLeave": 18.0,
  "annualLeaveUsed": 5.0,
  "remainingLeave": 13.0,
  "summerVacation1": null,
  "summerVacation5": null,
  "remarks": ""
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Nhân viên đã được tạo thành công",
  "data": {
    "employeeCode": "EMP002",
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 4. Cập nhật nhân viên
**PUT** `/api/v1/employees/{employeeCode}`

#### Tham số đường dẫn
- `employeeCode`: Mã nhân viên

#### Nội dung yêu cầu
Giống như tạo nhân viên

#### Phản hồi
```json
{
  "success": true,
  "message": "Nhân viên đã được cập nhật thành công",
  "data": {
    "employeeCode": "EMP002",
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 5. Xóa nhân viên
**DELETE** `/api/v1/employees/{employeeCode}`

#### Tham số đường dẫn
- `employeeCode`: Mã nhân viên

#### Phản hồi
```json
{
  "success": true,
  "message": "Nhân viên đã được xóa thành công"
}
```

### 6. Lấy chứng chỉ nhân viên
**GET** `/api/v1/employees/{employeeCode}/qualifications`

#### Tham số đường dẫn
- `employeeCode`: Mã nhân viên

#### Phản hồi
```json
{
  "data": [
    {
      "qualificationId": 1,
      "qualificationName": "Kỹ sư thông tin cơ bản",
      "grade": "Cơ bản",
      "type": "Chứng chỉ quốc gia",
      "amount": 5000.00,
      "isChecked": true,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    }
  ]
}
```

### 7. Lấy chi tiết nghỉ phép năm của nhân viên
**GET** `/api/v1/employees/{employeeCode}/annual-leave`

#### Tham số đường dẫn
- `employeeCode`: Mã nhân viên

#### Tham số truy vấn
- `year` (tùy chọn): Bộ lọc năm (mặc định: năm hiện tại)

#### Phản hồi
```json
{
  "data": [
    {
      "id": 1,
      "leaveDate": "2024-01-15",
      "days": 1.0,
      "count": 1
    },
    {
      "id": 2,
      "leaveDate": "2024-02-20",
      "days": 0.5,
      "count": 2
    }
  ]
}
```

## Phản hồi lỗi

### 400 Bad Request
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "Dữ liệu đầu vào không hợp lệ",
  "details": [
    {
      "field": "employeeCode",
      "message": "Mã nhân viên là bắt buộc"
    }
  ]
}
```

### 404 Not Found
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "message": "Không tìm thấy nhân viên"
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": "INTERNAL_ERROR",
  "message": "Đã xảy ra lỗi không mong muốn"
}
```

## Quy tắc nghiệp vụ

1. **Mã nhân viên**: Phải duy nhất và tuân theo định dạng công ty
2. **Xác thực ngày tháng**: 
   - Ngày sinh phải trước ngày vào làm
   - Ngày vào làm phải trước ngày nghỉ việc (nếu có)
   - Ngày chuẩn tính thâm niên nên giống ngày vào làm đối với nhân viên mới
3. **Tính toán nghỉ phép năm**:
   - Tổng nghỉ phép năm = Được cấp + Chuyển từ năm trước
   - Số ngày còn lại = Tổng - Đã sử dụng
4. **Xác thực địa chỉ**: Xác thực định dạng mã bưu điện cho địa chỉ Nhật Bản
5. **Xác thực số điện thoại**: Xác thực định dạng số điện thoại Nhật Bản

## Ràng buộc cơ sở dữ liệu

- Khóa chính: `社員コード`
- Mối quan hệ khóa ngoại với các bảng khác
- Ràng buộc kiểm tra cho xác thực ngày tháng
- Ràng buộc duy nhất cho mã nhân viên

---

*Tài liệu API này là một phần của Hệ thống Quản lý Nhân viên*
