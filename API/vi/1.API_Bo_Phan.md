# 2. API Bộ Phận
**Phiên bản:** v0.1  
**Ngày cập nhật:** 2025-10-25  
**Người biên soạn:** Chính  
**Người kiểm duyệt:** [PM/Leader Name]  
**Hệ thống:** Quản lý Nhân sự  

---

## Tổng quan
API quản lý dữ liệu bộ phận (T_部署名). Cung cấp chức năng quản lý bộ phận theo cấp bậc.

## URL cơ sở
`/api/v1/departments`

## Xác thực
Tất cả các endpoint đều yêu cầu Bearer Token

## Mô hình dữ liệu

### Thực thể Bộ phận
```json
{
  "departmentId": "string",      // ID bộ phận (Khóa chính)
  "divisionId": "number",        // ID bộ phận quản lý (Khóa ngoại)
  "departmentName": "string"     // Tên bộ phận
}
```

## Các endpoint

### 1. Lấy tất cả bộ phận
**GET** `/api/v1/departments`

#### Tham số truy vấn
- `departmentId` (tùy chọn): ID bộ phận (tìm kiếm chính xác)
- `divisionId` (tùy chọn): ID bộ phận quản lý (tìm kiếm chính xác)
- `departmentName` (tùy chọn): Tên bộ phận (tìm kiếm mờ)
- `page` (tùy chọn): Số trang (mặc định: 1)
- `size` (tùy chọn): Kích thước trang (mặc định: 20)

#### Phản hồi
```json
{
  "content": [
    {
      "departmentId": "DEPT001",
      "divisionId": 1,
      "departmentName": "Phòng kinh doanh 1"
    },
    {
      "departmentId": "DEPT002",
      "divisionId": 1,
      "departmentName": "Phòng kinh doanh 2"
    }
  ],
  "totalElements": 100,
  "totalPages": 10,
  "currentPage": 1
}
```

### 2. Lấy bộ phận theo ID
**GET** `/api/v1/departments/{departmentId}`

#### Tham số đường dẫn
- `departmentId`: ID bộ phận

#### Phản hồi
```json
{
  "departmentId": "DEPT001",
  "divisionId": 1,
  "departmentName": "Phòng kinh doanh 1"
}
```

### 3. Tạo bộ phận
**POST** `/api/v1/departments`

#### Nội dung yêu cầu
```json
{
  "divisionId": 1,
  "departmentName": "Phòng kinh doanh 1"
}
```

#### Phản hồi
```json
{
  "departmentId": "DEPT001",
  "divisionId": 1,
  "departmentName": "Phòng kinh doanh 1"
}
```

### 4. Cập nhật bộ phận
**PUT** `/api/v1/departments/{departmentId}`

#### Tham số đường dẫn
- `departmentId`: ID bộ phận

#### Nội dung yêu cầu
```json
{
  "divisionId": 1,
  "departmentName": "Phòng kế hoạch kinh doanh"
}
```

#### Phản hồi
```json
{
  "departmentId": "DEPT001",
  "divisionId": 1,
  "departmentName": "Phòng kế hoạch kinh doanh"
}
```

### 5. Xóa bộ phận
**DELETE** `/api/v1/departments/{departmentId}`

#### Tham số đường dẫn
- `departmentId`: ID bộ phận

#### Phản hồi
```json
{
  "success": true
}
```

## Phản hồi lỗi

### 400 Bad Request
```json
{
  "error": "Bad Request",
  "message": "Invalid request parameters",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### 404 Not Found
```json
{
  "error": "Not Found",
  "message": "Department not found",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### 500 Internal Server Error
```json
{
  "error": "Internal Server Error",
  "message": "An unexpected error occurred",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

## Quy tắc nghiệp vụ

1. **ID Bộ phận**: Phải duy nhất trong tất cả các bộ phận
2. **ID Bộ phận quản lý**: Phải tham chiếu đến bộ phận quản lý cấp cao hiện có
3. **Xác thực tên**: Tên bộ phận không được để trống
4. **Xác thực cấp bậc**: Bộ phận phải thuộc về bộ phận quản lý hợp lệ

## Ràng buộc cơ sở dữ liệu

- Khóa chính: `部署ID`
- Khóa ngoại: `T_部署名.部門ID` → `T_統括部門.部門ID`
- Ràng buộc duy nhất cho ID bộ phận
- Ràng buộc kiểm tra cho xác thực tên

## Ví dụ sử dụng

### Lấy tất cả bộ phận
```bash
curl -X GET "https://api.company.com/api/v1/departments" \
  -H "Authorization: Bearer your-token"
```

### Tạo bộ phận mới
```bash
curl -X POST "https://api.company.com/api/v1/departments" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "divisionId": 1,
    "departmentName": "Phòng marketing"
  }'
```

---

*Tài liệu API này là một phần của Hệ thống Quản lý Nhân viên*
