# 2. API Bộ Phận

## Tổng quan
API quản lý dữ liệu bộ phận bao gồm bộ phận quản lý cấp cao (T_統括部門) và tên bộ phận (T_部署名). Cung cấp chức năng quản lý bộ phận theo cấp bậc.

## URL cơ sở
`/api/v1/departments`

## Xác thực
Tất cả các endpoint đều yêu cầu Bearer Token

## Mô hình dữ liệu

### Thực thể Bộ phận quản lý cấp cao
```json
{
  "divisionId": "number",        // ID bộ phận (Khóa chính)
  "divisionName": "string",      // Tên bộ phận quản lý
  "field1": "string"             // Trường 1
}
```

### Thực thể Bộ phận
```json
{
  "departmentId": "string",      // ID bộ phận (Khóa chính)
  "divisionId": "number",        // ID bộ phận quản lý (Khóa ngoại)
  "departmentName": "string"     // Tên bộ phận
}
```

## Các endpoint

### 1. Lấy tất cả bộ phận quản lý cấp cao
**GET** `/api/v1/departments/divisions`

#### Phản hồi
```json
{
  "data": [
    {
      "divisionId": 1,
      "divisionName": "Bộ phận kinh doanh",
      "field1": "Liên quan kinh doanh"
    },
    {
      "divisionId": 2,
      "divisionName": "Bộ phận kỹ thuật",
      "field1": "Liên quan kỹ thuật"
    }
  ]
}
```

### 2. Tạo bộ phận quản lý cấp cao
**POST** `/api/v1/departments/divisions`

#### Nội dung yêu cầu
```json
{
  "divisionName": "Bộ phận nhân sự",
  "field1": "Liên quan nhân sự"
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Bộ phận quản lý cấp cao đã được tạo thành công",
  "data": {
    "divisionId": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 3. Cập nhật bộ phận quản lý cấp cao
**PUT** `/api/v1/departments/divisions/{divisionId}`

#### Tham số đường dẫn
- `divisionId`: ID bộ phận

#### Nội dung yêu cầu
```json
{
  "divisionName": "Bộ phận kế hoạch kinh doanh",
  "field1": "Liên quan kế hoạch kinh doanh"
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Bộ phận quản lý cấp cao đã được cập nhật thành công",
  "data": {
    "divisionId": 1,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 4. Xóa bộ phận quản lý cấp cao
**DELETE** `/api/v1/departments/divisions/{divisionId}`

#### Tham số đường dẫn
- `divisionId`: ID bộ phận

#### Phản hồi
```json
{
  "success": true,
  "message": "Bộ phận quản lý cấp cao đã được xóa thành công"
}
```

### 5. Lấy tất cả bộ phận
**GET** `/api/v1/departments`

#### Tham số truy vấn
- `divisionId` (tùy chọn): Lọc theo ID bộ phận quản lý
- `page` (tùy chọn): Số trang (mặc định: 1)
- `size` (tùy chọn): Kích thước trang (mặc định: 20)

#### Phản hồi
```json
{
  "data": [
    {
      "departmentId": "DEPT001",
      "divisionId": 1,
      "departmentName": "Phòng kinh doanh 1",
      "divisionName": "Bộ phận kinh doanh"
    },
    {
      "departmentId": "DEPT002",
      "divisionId": 1,
      "departmentName": "Phòng kinh doanh 2",
      "divisionName": "Bộ phận kinh doanh"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 50,
    "totalPages": 3
  }
}
```

### 6. Lấy bộ phận theo ID
**GET** `/api/v1/departments/{departmentId}`

#### Tham số đường dẫn
- `departmentId`: ID bộ phận

#### Phản hồi
```json
{
  "data": {
    "departmentId": "DEPT001",
    "divisionId": 1,
    "departmentName": "Phòng kinh doanh 1",
    "divisionName": "Bộ phận kinh doanh"
  }
}
```

### 7. Tạo bộ phận
**POST** `/api/v1/departments`

#### Nội dung yêu cầu
```json
{
  "departmentId": "DEPT003",
  "divisionId": 2,
  "departmentName": "Phòng phát triển 1"
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Bộ phận đã được tạo thành công",
  "data": {
    "departmentId": "DEPT003",
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 8. Cập nhật bộ phận
**PUT** `/api/v1/departments/{departmentId}`

#### Tham số đường dẫn
- `departmentId`: ID bộ phận

#### Nội dung yêu cầu
```json
{
  "divisionId": 2,
  "departmentName": "Phòng kế hoạch phát triển"
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Bộ phận đã được cập nhật thành công",
  "data": {
    "departmentId": "DEPT003",
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 9. Xóa bộ phận
**DELETE** `/api/v1/departments/{departmentId}`

#### Tham số đường dẫn
- `departmentId`: ID bộ phận

#### Phản hồi
```json
{
  "success": true,
  "message": "Bộ phận đã được xóa thành công"
}
```

### 10. Lấy bộ phận theo bộ phận quản lý
**GET** `/api/v1/departments/by-division/{divisionId}`

#### Tham số đường dẫn
- `divisionId`: ID bộ phận quản lý

#### Phản hồi
```json
{
  "data": [
    {
      "departmentId": "DEPT001",
      "departmentName": "Phòng kinh doanh 1"
    },
    {
      "departmentId": "DEPT002",
      "departmentName": "Phòng kinh doanh 2"
    }
  ]
}
```

### 11. Lấy cấu trúc bộ phận
**GET** `/api/v1/departments/hierarchy`

#### Phản hồi
```json
{
  "data": [
    {
      "divisionId": 1,
      "divisionName": "Bộ phận kinh doanh",
      "field1": "Liên quan kinh doanh",
      "departments": [
        {
          "departmentId": "DEPT001",
          "departmentName": "Phòng kinh doanh 1"
        },
        {
          "departmentId": "DEPT002",
          "departmentName": "Phòng kinh doanh 2"
        }
      ]
    },
    {
      "divisionId": 2,
      "divisionName": "Bộ phận kỹ thuật",
      "field1": "Liên quan kỹ thuật",
      "departments": [
        {
          "departmentId": "DEPT003",
          "departmentName": "Phòng phát triển 1"
        }
      ]
    }
  ]
}
```

## Phản hồi lỗi

### 400 Bad Request
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "Dữ liệu đầu vào không hợp lệ",
  "details": [
    {
      "field": "departmentName",
      "message": "Tên bộ phận là bắt buộc"
    }
  ]
}
```

### 404 Not Found
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "message": "Không tìm thấy bộ phận"
}
```

### 409 Conflict
```json
{
  "success": false,
  "error": "CONFLICT",
  "message": "ID bộ phận đã tồn tại"
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": "INTERNAL_ERROR",
  "message": "Đã xảy ra lỗi không mong muốn"
}
```

## Quy tắc nghiệp vụ

1. **ID Bộ phận**: Phải duy nhất trong tất cả các bộ phận
2. **ID Bộ phận quản lý**: Phải tham chiếu đến bộ phận quản lý cấp cao hiện có
3. **Xóa liên tục**: Xóa bộ phận quản lý cấp cao phải xử lý các bộ phận liên quan
4. **Xác thực tên**: Tên bộ phận và tên bộ phận quản lý không được để trống
5. **Xác thực cấp bậc**: Bộ phận phải thuộc về bộ phận quản lý hợp lệ

## Ràng buộc cơ sở dữ liệu

- Khóa chính: `部門ID`, `部署ID`
- Khóa ngoại: `T_部署名.部門ID` → `T_統括部門.部門ID`
- Ràng buộc duy nhất cho ID bộ phận
- Ràng buộc kiểm tra cho xác thực tên

## Ví dụ sử dụng

### Lấy cấu trúc bộ phận
```bash
curl -X GET "https://api.company.com/api/v1/departments/hierarchy" \
  -H "Authorization: Bearer your-token"
```

### Tạo bộ phận mới
```bash
curl -X POST "https://api.company.com/api/v1/departments" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "departmentId": "DEPT004",
    "divisionId": 1,
    "departmentName": "Phòng kinh doanh 3"
  }'
```

### Lấy bộ phận theo bộ phận quản lý
```bash
curl -X GET "https://api.company.com/api/v1/departments/by-division/1" \
  -H "Authorization: Bearer your-token"
```

---

*Tài liệu API này là một phần của Hệ thống Quản lý Nhân viên*
