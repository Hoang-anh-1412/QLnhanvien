# 3. API Chứng Chỉ

## Tổng quan
API quản lý dữ liệu chứng chỉ bao gồm phụ cấp chứng chỉ (T_資格手当) và chứng chỉ nhân viên (T_資格). Cung cấp chức năng quản lý chứng chỉ toàn diện.

## Base URL
`/api/v1/qualifications`

## Xác thực
Bearer Token bắt buộc cho tất cả các endpoint

## Mô hình dữ liệu

### Thực thể Phụ cấp Chứng chỉ
```json
{
  "qualificationId": "number",        // ID chứng chỉ (Khóa chính)
  "name": "string",                   // Tên
  "grade": "string",                  // Cấp độ
  "type": "string",                   // Loại
  "amount": "number",                 // Số tiền
  "remarks": "string"                 // Ghi chú
}
```

### Thực thể Chứng chỉ Nhân viên
```json
{
  "id": "number",                     // ID (Khóa chính)
  "employeeCode": "string",           // Mã nhân viên (Khóa ngoại)
  "name": "string",                   // Tên
  "grade": "string",                  // Cấp độ
  "type": "string",                   // Loại
  "amount": "number",                 // Số tiền
  "isChecked": "boolean",             // Đã kiểm tra
  "certificateNumber": "string",      // Số chứng chỉ
  "acquisitionDate": "date",          // Ngày cấp
  "qualificationTypeId": "number"     // ID loại chứng chỉ (Khóa ngoại)
}
```

## Endpoints

### 1. Lấy tất cả Phụ cấp Chứng chỉ
**GET** `/api/v1/qualifications/allowances`

#### Tham số truy vấn
- `page` (tùy chọn): Số trang (mặc định: 1)
- `size` (tùy chọn): Kích thước trang (mặc định: 20)
- `name` (tùy chọn): Lọc theo tên chứng chỉ
- `type` (tùy chọn): Lọc theo loại chứng chỉ

#### Phản hồi
```json
{
  "data": [
    {
      "qualificationId": 1,
      "name": "Kỹ sư Thông tin Cơ bản",
      "grade": "Cơ bản",
      "type": "Chứng chỉ Quốc gia",
      "amount": 5000.00,
      "remarks": "Chứng chỉ IT cơ bản"
    },
    {
      "qualificationId": 2,
      "name": "Kỹ sư Thông tin Ứng dụng",
      "grade": "Ứng dụng",
      "type": "Chứng chỉ Quốc gia",
      "amount": 8000.00,
      "remarks": "Chứng chỉ IT ứng dụng"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 50,
    "totalPages": 3
  }
}
```

### 2. Lấy Phụ cấp Chứng chỉ theo ID
**GET** `/api/v1/qualifications/allowances/{qualificationId}`

#### Tham số đường dẫn
- `qualificationId`: ID chứng chỉ

#### Phản hồi
```json
{
  "data": {
    "qualificationId": 1,
    "name": "Kỹ sư Thông tin Cơ bản",
    "grade": "Cơ bản",
    "type": "Chứng chỉ Quốc gia",
    "amount": 5000.00,
    "remarks": "Chứng chỉ IT cơ bản"
  }
}
```

### 3. Tạo Phụ cấp Chứng chỉ
**POST** `/api/v1/qualifications/allowances`

#### Nội dung yêu cầu
```json
{
  "name": "Chuyên gia Cơ sở Dữ liệu",
  "grade": "Chuyên môn",
  "type": "Chứng chỉ Quốc gia",
  "amount": 10000.00,
  "remarks": "Chứng chỉ chuyên môn cơ sở dữ liệu"
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Phụ cấp chứng chỉ đã được tạo thành công",
  "data": {
    "qualificationId": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 4. Cập nhật Phụ cấp Chứng chỉ
**PUT** `/api/v1/qualifications/allowances/{qualificationId}`

#### Tham số đường dẫn
- `qualificationId`: ID chứng chỉ

#### Nội dung yêu cầu
```json
{
  "name": "Chuyên gia Cơ sở Dữ liệu (Cập nhật)",
  "grade": "Chuyên môn",
  "type": "Chứng chỉ Quốc gia",
  "amount": 12000.00,
  "remarks": "Chứng chỉ chuyên môn cơ sở dữ liệu (Cập nhật)"
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Phụ cấp chứng chỉ đã được cập nhật thành công",
  "data": {
    "qualificationId": 3,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 5. Xóa Phụ cấp Chứng chỉ
**DELETE** `/api/v1/qualifications/allowances/{qualificationId}`

#### Tham số đường dẫn
- `qualificationId`: ID chứng chỉ

#### Phản hồi
```json
{
  "success": true,
  "message": "Phụ cấp chứng chỉ đã được xóa thành công"
}
```

### 6. Lấy Chứng chỉ Nhân viên
**GET** `/api/v1/qualifications/employees/{employeeCode}`

#### Tham số đường dẫn
- `employeeCode`: Mã nhân viên

#### Tham số truy vấn
- `year` (tùy chọn): Lọc theo năm cấp
- `type` (tùy chọn): Lọc theo loại chứng chỉ

#### Phản hồi
```json
{
  "data": [
    {
      "id": 1,
      "employeeCode": "EMP001",
      "name": "Kỹ sư Thông tin Cơ bản",
      "grade": "Cơ bản",
      "type": "Chứng chỉ Quốc gia",
      "amount": 5000.00,
      "isChecked": true,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    },
    {
      "id": 2,
      "employeeCode": "EMP001",
      "name": "Kỹ sư Thông tin Ứng dụng",
      "grade": "Ứng dụng",
      "type": "Chứng chỉ Quốc gia",
      "amount": 8000.00,
      "isChecked": false,
      "certificateNumber": "AP2024001",
      "acquisitionDate": "2024-06-20",
      "qualificationTypeId": 2
    }
  ]
}
```

### 7. Tạo Chứng chỉ Nhân viên
**POST** `/api/v1/qualifications/employees`

#### Nội dung yêu cầu
```json
{
  "employeeCode": "EMP001",
  "name": "Chuyên gia Cơ sở Dữ liệu",
  "grade": "Chuyên môn",
  "type": "Chứng chỉ Quốc gia",
  "amount": 10000.00,
  "isChecked": true,
  "certificateNumber": "DB2024001",
  "acquisitionDate": "2024-09-10",
  "qualificationTypeId": 3
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Chứng chỉ nhân viên đã được tạo thành công",
  "data": {
    "id": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 8. Cập nhật Chứng chỉ Nhân viên
**PUT** `/api/v1/qualifications/employees/{id}`

#### Tham số đường dẫn
- `id`: ID bản ghi chứng chỉ

#### Nội dung yêu cầu
```json
{
  "name": "Chuyên gia Cơ sở Dữ liệu (Cập nhật)",
  "grade": "Chuyên môn",
  "type": "Chứng chỉ Quốc gia",
  "amount": 12000.00,
  "isChecked": true,
  "certificateNumber": "DB2024001",
  "acquisitionDate": "2024-09-10",
  "qualificationTypeId": 3
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Chứng chỉ nhân viên đã được cập nhật thành công",
  "data": {
    "id": 3,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 9. Xóa Chứng chỉ Nhân viên
**DELETE** `/api/v1/qualifications/employees/{id}`

#### Tham số đường dẫn
- `id`: ID bản ghi chứng chỉ

#### Phản hồi
```json
{
  "success": true,
  "message": "Chứng chỉ nhân viên đã được xóa thành công"
}
```

### 10. Lấy Thống kê Chứng chỉ
**GET** `/api/v1/qualifications/statistics`

#### Tham số truy vấn
- `divisionId` (tùy chọn): Lọc theo phòng ban
- `departmentId` (tùy chọn): Lọc theo bộ phận
- `year` (tùy chọn): Lọc theo năm

#### Phản hồi
```json
{
  "data": {
    "totalQualifications": 150,
    "qualificationsByType": [
      {
        "type": "Chứng chỉ Quốc gia",
        "count": 80,
        "percentage": 53.3
      },
      {
        "type": "Chứng chỉ Tư nhân",
        "count": 70,
        "percentage": 46.7
      }
    ],
    "qualificationsByGrade": [
      {
        "grade": "Cơ bản",
        "count": 60,
        "percentage": 40.0
      },
      {
        "grade": "Ứng dụng",
        "count": 50,
        "percentage": 33.3
      },
      {
        "grade": "Chuyên môn",
        "count": 40,
        "percentage": 26.7
      }
    ],
    "totalAllowanceAmount": 750000.00
  }
}
```

### 11. Tìm kiếm Chứng chỉ
**GET** `/api/v1/qualifications/search`

#### Tham số truy vấn
- `keyword` (bắt buộc): Từ khóa tìm kiếm
- `type` (tùy chọn): Lọc theo loại chứng chỉ
- `grade` (tùy chọn): Lọc theo cấp độ
- `employeeCode` (tùy chọn): Lọc theo nhân viên

#### Phản hồi
```json
{
  "data": [
    {
      "id": 1,
      "employeeCode": "EMP001",
      "employeeName": "Nguyễn Văn A",
      "name": "Kỹ sư Thông tin Cơ bản",
      "grade": "Cơ bản",
      "type": "Chứng chỉ Quốc gia",
      "amount": 5000.00,
      "acquisitionDate": "2024-03-15"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 25,
    "totalPages": 2
  }
}
```

### 12. Nhập hàng loạt Chứng chỉ
**POST** `/api/v1/qualifications/import`

#### Nội dung yêu cầu
```json
{
  "qualifications": [
    {
      "employeeCode": "EMP001",
      "name": "Kỹ sư Thông tin Cơ bản",
      "grade": "Cơ bản",
      "type": "Chứng chỉ Quốc gia",
      "amount": 5000.00,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    },
    {
      "employeeCode": "EMP002",
      "name": "Kỹ sư Thông tin Ứng dụng",
      "grade": "Ứng dụng",
      "type": "Chứng chỉ Quốc gia",
      "amount": 8000.00,
      "certificateNumber": "AP2024002",
      "acquisitionDate": "2024-04-20",
      "qualificationTypeId": 2
    }
  ]
}
```

#### Phản hồi
```json
{
  "success": true,
  "message": "Chứng chỉ đã được nhập thành công",
  "data": {
    "importedCount": 2,
    "failedCount": 0,
    "errors": []
  }
}
```

## Phản hồi lỗi

### 400 Bad Request
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "Dữ liệu đầu vào không hợp lệ",
  "details": [
    {
      "field": "name",
      "message": "Tên chứng chỉ là bắt buộc"
    }
  ]
}
```

### 404 Not Found
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "message": "Không tìm thấy chứng chỉ"
}
```

### 409 Conflict
```json
{
  "success": false,
  "error": "CONFLICT",
  "message": "Chứng chỉ của nhân viên này đã tồn tại"
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": "INTERNAL_ERROR",
  "message": "Đã xảy ra lỗi không mong muốn"
}
```

## Quy tắc nghiệp vụ

1. **Phụ cấp Chứng chỉ**: Phải duy nhất theo tổ hợp tên và cấp độ
2. **Chứng chỉ Nhân viên**: Mã nhân viên phải tham chiếu đến nhân viên hiện có
3. **Xác thực Số tiền**: Số tiền phải là số dương
4. **Xác thực Ngày**: Ngày cấp không thể là ngày trong tương lai
5. **Số Chứng chỉ**: Phải duy nhất trong cùng loại chứng chỉ
6. **Trạng thái Kiểm tra**: Chỉ có thể là true nếu ngày cấp đã được thiết lập

## Ràng buộc cơ sở dữ liệu

- Khóa chính: `資格ID`, `ID`
- Khóa ngoại: 
  - `T_資格.社員コード` → `T_社員マスタ.社員コード`
  - `T_資格.資格ID` → `T_資格手当.資格ID`
- Ràng buộc duy nhất cho số chứng chỉ
- Ràng buộc kiểm tra cho xác thực số tiền

## Ví dụ sử dụng

### Lấy chứng chỉ của nhân viên cụ thể
```bash
curl -X GET "https://api.company.com/api/v1/qualifications/employees/EMP001" \
  -H "Authorization: Bearer your-token"
```

### Tạo phụ cấp chứng chỉ mới
```bash
curl -X POST "https://api.company.com/api/v1/qualifications/allowances" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Chứng chỉ mới",
    "grade": "Cơ bản",
    "type": "Chứng chỉ Quốc gia",
    "amount": 5000.00,
    "remarks": "Chứng chỉ mới"
  }'
```

### Tìm kiếm chứng chỉ
```bash
curl -X GET "https://api.company.com/api/v1/qualifications/search?keyword=kỹ thuật thông tin" \
  -H "Authorization: Bearer your-token"
```

---

*Tài liệu API này là một phần của Hệ thống Quản lý Nhân viên*
