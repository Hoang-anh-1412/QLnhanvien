# Hướng Dẫn Thiết Kế RESTful API

## Tổng quan
Tài liệu này mô tả các nguyên tắc và tiêu chuẩn thiết kế RESTful API được sử dụng trong toàn bộ Hệ thống Quản lý Nhân viên.

## Nguyên tắc RESTful API

### 1. URL dựa trên Resource
- Sử dụng danh từ, không phải động từ trong URL
- Sử dụng danh từ số nhiều cho collections
- Sử dụng cấu trúc phân cấp cho các resource liên quan

**Ví dụ:**
```
✅ Tốt:
GET /api/v1/employees
GET /api/v1/employees/{id}
GET /api/v1/employees/{id}/qualifications
GET /api/v1/departments/{id}/employees

❌ Không tốt:
GET /api/v1/getEmployees
GET /api/v1/employee/{id}/getQualifications
```

### 2. HTTP Methods
Sử dụng các HTTP methods phù hợp cho các thao tác khác nhau:

| Method | Mục đích | Ví dụ |
|--------|----------|-------|
| GET | Lấy resource(s) | `GET /api/v1/employees` |
| POST | Tạo resource mới | `POST /api/v1/employees` |
| PUT | Cập nhật toàn bộ resource | `PUT /api/v1/employees/{id}` |
| PATCH | Cập nhật một phần | `PATCH /api/v1/employees/{id}` |
| DELETE | Xóa resource | `DELETE /api/v1/employees/{id}` |

### 3. HTTP Status Codes
Sử dụng các HTTP status codes phù hợp:

| Code | Ý nghĩa | Sử dụng |
|------|---------|---------|
| 200 | OK | GET, PUT, PATCH thành công |
| 201 | Created | POST thành công |
| 204 | No Content | DELETE thành công |
| 400 | Bad Request | Dữ liệu request không hợp lệ |
| 401 | Unauthorized | Thiếu hoặc sai xác thực |
| 403 | Forbidden | Xác thực hợp lệ nhưng không đủ quyền |
| 404 | Not Found | Không tìm thấy resource |
| 409 | Conflict | Resource đã tồn tại |
| 422 | Unprocessable Entity | Lỗi validation |
| 500 | Internal Server Error | Lỗi server |

### 4. Định dạng Request/Response

#### Request Headers
```
Content-Type: application/json
Authorization: Bearer {token}
Accept: application/json
```

#### Định dạng Response
```json
{
  "success": true,
  "data": { ... },
  "message": "Thao tác hoàn thành thành công",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 100,
    "totalPages": 5
  }
}
```

#### Định dạng Error Response
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "Dữ liệu đầu vào không hợp lệ",
  "details": [
    {
      "field": "email",
      "message": "Email là bắt buộc"
    }
  ]
}
```

### 5. Query Parameters
Sử dụng query parameters cho filtering, sorting và pagination:

```
GET /api/v1/employees?page=1&size=20&sort=name,asc&department=IT
GET /api/v1/employees?search=john&isActive=true
GET /api/v1/qualifications?type=technical&year=2024
```

### 6. Pagination
Triển khai pagination nhất quán trên tất cả các list endpoints:

```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 100,
    "totalPages": 5,
    "hasNext": true,
    "hasPrevious": false
  }
}
```

### 7. Filtering và Searching
Hỗ trợ filtering và searching với query parameters:

```
# Lọc theo phòng ban
GET /api/v1/employees?department=IT

# Tìm kiếm theo tên
GET /api/v1/employees?search=john

# Nhiều bộ lọc
GET /api/v1/employees?department=IT&isActive=true&hireDate=2024-01-01

# Lọc theo khoảng ngày
GET /api/v1/employees?hireDateFrom=2024-01-01&hireDateTo=2024-12-31
```

### 8. Sorting
Hỗ trợ sorting với parameter `sort`:

```
# Sắp xếp theo một trường
GET /api/v1/employees?sort=name

# Sắp xếp theo nhiều trường
GET /api/v1/employees?sort=department,name

# Sắp xếp giảm dần
GET /api/v1/employees?sort=name,desc
```

### 9. API Versioning
Sử dụng URL versioning cho các phiên bản API:

```
/api/v1/employees
/api/v2/employees
```

### 10. Authentication
Sử dụng Bearer Token authentication:

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 11. Rate Limiting
Triển khai rate limiting với headers:

```
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1640995200
```

### 12. Caching
Sử dụng các cache headers phù hợp:

```
Cache-Control: public, max-age=3600
ETag: "1234567890"
Last-Modified: Wed, 21 Oct 2024 07:28:00 GMT
```

## Cấu trúc API Endpoints

### Quản lý Nhân viên
```
GET    /api/v1/employees              # Danh sách nhân viên
POST   /api/v1/employees              # Tạo nhân viên
GET    /api/v1/employees/{id}         # Lấy nhân viên
PUT    /api/v1/employees/{id}         # Cập nhật nhân viên
PATCH  /api/v1/employees/{id}         # Cập nhật một phần
DELETE /api/v1/employees/{id}         # Xóa nhân viên
```

### Quản lý Phòng ban
```
GET    /api/v1/departments            # Danh sách phòng ban
POST   /api/v1/departments            # Tạo phòng ban
GET    /api/v1/departments/{id}       # Lấy phòng ban
PUT    /api/v1/departments/{id}       # Cập nhật phòng ban
DELETE /api/v1/departments/{id}       # Xóa phòng ban
```

### Quản lý Chứng chỉ
```
GET    /api/v1/qualifications         # Danh sách chứng chỉ
POST   /api/v1/qualifications         # Tạo chứng chỉ
GET    /api/v1/qualifications/{id}    # Lấy chứng chỉ
PUT    /api/v1/qualifications/{id}    # Cập nhật chứng chỉ
DELETE /api/v1/qualifications/{id}    # Xóa chứng chỉ
```

### Quản lý Nghỉ phép Năm
```
GET    /api/v1/annual-leaves          # Danh sách nghỉ phép năm
POST   /api/v1/annual-leaves          # Tạo nghỉ phép năm
GET    /api/v1/annual-leaves/{id}     # Lấy nghỉ phép năm
PUT    /api/v1/annual-leaves/{id}     # Cập nhật nghỉ phép năm
DELETE /api/v1/annual-leaves/{id}     # Xóa nghỉ phép năm
```

### Quản lý Giấy phép Hàn
```
GET    /api/v1/welding-licenses       # Danh sách giấy phép hàn
POST   /api/v1/welding-licenses       # Tạo giấy phép hàn
GET    /api/v1/welding-licenses/{id}  # Lấy giấy phép hàn
PUT    /api/v1/welding-licenses/{id}  # Cập nhật giấy phép hàn
DELETE /api/v1/welding-licenses/{id}  # Xóa giấy phép hàn
```

## Best Practices

### 1. Đặt tên nhất quán
- Sử dụng camelCase cho JSON properties
- Sử dụng kebab-case cho URLs
- Sử dụng tên mô tả

### 2. Xử lý Lỗi
- Luôn trả về HTTP status codes phù hợp
- Cung cấp thông báo lỗi có ý nghĩa
- Bao gồm lỗi validation cấp trường

### 3. Tài liệu
- Tài liệu hóa tất cả endpoints
- Cung cấp ví dụ request/response
- Bao gồm các kịch bản lỗi

### 4. Bảo mật
- Validate tất cả dữ liệu đầu vào
- Sử dụng HTTPS trong production
- Triển khai xác thực phù hợp
- Sanitize user input

### 5. Hiệu suất
- Triển khai pagination cho datasets lớn
- Sử dụng HTTP caching phù hợp
- Tối ưu hóa database queries
- Cân nhắc API rate limiting

## Ví dụ Triển khai

### Ví dụ CRUD hoàn chỉnh
```javascript
// Tạo Nhân viên
POST /api/v1/employees
{
  "employeeCode": "EMP001",
  "fullName": "Nguyễn Văn A",
  "department": "IT",
  "hireDate": "2024-01-15"
}

// Response
{
  "success": true,
  "data": {
    "id": 1,
    "employeeCode": "EMP001",
    "fullName": "Nguyễn Văn A",
    "department": "IT",
    "hireDate": "2024-01-15",
    "createdAt": "2024-01-15T10:30:00Z"
  },
  "message": "Nhân viên đã được tạo thành công"
}

// Lấy Nhân viên
GET /api/v1/employees/1

// Cập nhật Nhân viên
PUT /api/v1/employees/1
{
  "employeeCode": "EMP001",
  "fullName": "Nguyễn Thị B",
  "department": "IT",
  "hireDate": "2024-01-15"
}

// Xóa Nhân viên
DELETE /api/v1/employees/1
```

---

*Hướng dẫn này đảm bảo thiết kế RESTful API nhất quán trong toàn bộ Hệ thống Quản lý Nhân viên*
