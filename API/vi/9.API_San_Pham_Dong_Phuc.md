# 9. API Sản Phẩm Đồng Phục (品目マスター)

**Phiên bản:** v0.1  
**Ngày cập nhật:** 2025-10-25  
**Tác giả:** Chính  
**Người kiểm duyệt:** [PM/Leader Name]  
**Hệ thống:** Quản lý Nhân sự  

---

## 1. Tổng quan
API quản lý danh mục sản phẩm đồng phục (品目マスター) - quản lý thông tin sản phẩm, kích thước, màu sắc và giá cả.

**Database Table:** `T_品目マスター` (cần tạo mới)

---

## 2. Endpoints

### 2.1. Lấy danh sách sản phẩm đồng phục
- **API Call:** `GET /api/v1/items`
- **Mô tả:** Lấy danh sách tất cả sản phẩm đồng phục
- **Query Parameters:**
  - `page` (number, optional): Số trang (mặc định: 1)
  - `size` (number, optional): Kích thước trang (mặc định: 20, tối đa: 100)
  - `search` (string, optional): Tìm kiếm theo tên sản phẩm
  - `category` (string, optional): Lọc theo danh mục
  - `isActive` (boolean, optional): Lọc theo trạng thái hoạt động
  - `sort` (string, optional): Sắp xếp (mặc định: itemName,asc)

**Response Data Type:**
```typescript
interface Item {
  itemCode: string;
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}

interface ItemListResponse {
  success: true;
  data: Item[];
  message: "Lấy danh sách sản phẩm đồng phục thành công";
  pagination: {
    page: number;
    size: number;
    totalElements: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

**Example Response:**
```json
{
  "success": true,
  "data": [
    {
      "itemCode": "UF001",
      "itemName": "作業服 上下セット",
      "category": "作業服",
      "description": "標準的な作業服上下セット",
      "availableSizes": ["S", "M", "L", "XL", "XXL"],
      "availableColors": ["ネイビー", "グレー", "ブラック"],
      "unitPrice": 75000,
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    },
    {
      "itemCode": "UF002",
      "itemName": "安全靴",
      "category": "靴",
      "description": "安全基準準拠の作業靴",
      "availableSizes": ["24", "25", "26", "27", "28", "29", "30"],
      "availableColors": ["ブラック", "ブラウン"],
      "unitPrice": 25000,
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "message": "Lấy danh sách sản phẩm đồng phục thành công",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 2,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

### 2.2. Lấy thông tin sản phẩm theo mã
- **API Call:** `GET /api/v1/items/{itemCode}`
- **Mô tả:** Lấy thông tin chi tiết một sản phẩm
- **Path Parameters:**
  - `itemCode` (string, required): Mã sản phẩm

**Response Data Type:**
```typescript
interface ItemDetailResponse {
  success: true;
  data: Item;
  message: "Lấy thông tin sản phẩm thành công";
}
```

### 2.3. Tạo sản phẩm mới
- **API Call:** `POST /api/v1/items`
- **Mô tả:** Tạo sản phẩm đồng phục mới
- **Request Data Type:**
```typescript
interface CreateItemRequest {
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive?: boolean;
}
```

**Response Data Type:**
```typescript
interface CreateItemResponse {
  success: true;
  data: Item;
  message: "Tạo sản phẩm thành công";
}
```

### 2.4. Cập nhật sản phẩm
- **API Call:** `PUT /api/v1/items/{itemCode}`
- **Mô tả:** Cập nhật thông tin sản phẩm
- **Path Parameters:**
  - `itemCode` (string, required): Mã sản phẩm
- **Request Data Type:**
```typescript
interface UpdateItemRequest {
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive: boolean;
}
```

**Response Data Type:**
```typescript
interface UpdateItemResponse {
  success: true;
  data: Item;
  message: "Cập nhật sản phẩm thành công";
}
```

### 2.5. Xóa sản phẩm
- **API Call:** `DELETE /api/v1/items/{itemCode}`
- **Mô tả:** Xóa sản phẩm (soft delete)
- **Path Parameters:**
  - `itemCode` (string, required): Mã sản phẩm

**Response Data Type:**
```typescript
interface DeleteItemResponse {
  success: true;
  data: null;
  message: "Xóa sản phẩm thành công";
}
```

### 2.6. Cập nhật trạng thái sản phẩm
- **API Call:** `PATCH /api/v1/items/{itemCode}/status`
- **Mô tả:** Cập nhật trạng thái hoạt động của sản phẩm
- **Path Parameters:**
  - `itemCode` (string, required): Mã sản phẩm
- **Request Data Type:**
```typescript
interface UpdateItemStatusRequest {
  isActive: boolean;
}
```

---

## 3. Error Responses

### 3.1. Validation Error
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "code": "ITEM_001",
  "message": "Dữ liệu đầu vào không hợp lệ",
  "details": [
    {
      "field": "itemName",
      "message": "Tên sản phẩm là bắt buộc",
      "code": "FIELD_REQUIRED"
    },
    {
      "field": "unitPrice",
      "message": "Giá sản phẩm phải lớn hơn 0",
      "code": "INVALID_PRICE"
    }
  ]
}
```

### 3.2. Not Found Error
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "code": "ITEM_002",
  "message": "Không tìm thấy sản phẩm",
  "details": []
}
```

### 3.3. Conflict Error
```json
{
  "success": false,
  "error": "CONFLICT",
  "code": "ITEM_003",
  "message": "Mã sản phẩm đã tồn tại",
  "details": []
}
```

---

## 4. Business Rules

### 4.1. Validation Rules
- **itemCode:** Tự động tạo, format: UF + 3 số (UF001, UF002...)
- **itemName:** Bắt buộc, tối đa 100 ký tự
- **category:** Bắt buộc, tối đa 50 ký tự
- **unitPrice:** Bắt buộc, phải > 0
- **availableSizes:** Bắt buộc, ít nhất 1 kích thước
- **availableColors:** Bắt buộc, ít nhất 1 màu sắc

### 4.2. Constraints
- Không thể xóa sản phẩm đang được sử dụng trong đơn hàng
- Soft delete: Đặt `isActive = false` thay vì xóa thật
- Tên sản phẩm phải duy nhất trong danh mục

### 4.3. Permissions
- **hr:read:** Xem danh sách và chi tiết sản phẩm
- **hr:write:** Tạo, cập nhật sản phẩm
- **hr:admin:** Xóa sản phẩm, cập nhật trạng thái

---

## 5. Database Schema

### 5.1. Table Structure
```sql
CREATE TABLE T_品目マスター (
    商品コード VARCHAR2(50 CHAR) PRIMARY KEY,
    商品名 VARCHAR2(100 CHAR),
    カテゴリ VARCHAR2(50 CHAR),
    説明 VARCHAR2(255 CHAR),
    利用可能サイズ CLOB, -- JSON array of sizes
    利用可能色 CLOB,     -- JSON array of colors
    単価 NUMBER(10, 2),
    有効フラグ NUMBER(1) DEFAULT 1,
    作成日時 TIMESTAMP,
    更新日時 TIMESTAMP
);

-- Sequence for auto-generating item codes
CREATE SEQUENCE SEQ_品目マスター_コード
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;
```

### 5.2. Indexes
- `IDX_品目マスター_商品名` on `T_品目マスター(商品名)`
- `IDX_品目マスター_カテゴリ` on `T_品目マスター(カテゴリ)`
- `IDX_品目マスター_有効フラグ` on `T_品目マスター(有効フラグ)`

---

## 6. Performance Considerations

### 6.1. Caching
- Cache danh sách sản phẩm trong 1 giờ
- Invalidate cache khi có thay đổi

### 6.2. Pagination
- Mặc định 20 items per page
- Tối đa 100 items per page
- Sử dụng OFFSET/LIMIT cho Oracle

---

## 7. Testing Scenarios

### 7.1. Happy Path
1. Lấy danh sách sản phẩm thành công
2. Tạo sản phẩm mới thành công
3. Cập nhật sản phẩm thành công
4. Cập nhật trạng thái sản phẩm thành công

### 7.2. Error Cases
1. Tạo sản phẩm với tên trùng lặp
2. Cập nhật sản phẩm không tồn tại
3. Xóa sản phẩm đang được sử dụng
4. Validation lỗi khi thiếu thông tin bắt buộc

---

*API này tuân thủ các quy tắc RESTful và tiêu chuẩn trong README.md*
