# 6. API Phòng Ban Giám Sát (統括部門)

**Phiên bản:** v0.1  
**Ngày cập nhật:** 2025-10-25  
**Tác giả:** Chính  
**Người kiểm duyệt:** [PM/Leader Name]  
**Hệ thống:** Quản lý Nhân sự  

---

## 1. Tổng quan
API quản lý thông tin phòng ban giám sát (統括部門) - các đơn vị quản lý cấp cao trong hệ thống.

**Database Table:** `T_統括部門`

---

## 2. Endpoints

### 2.1. Lấy danh sách phòng ban giám sát
- **API Call:** `GET /api/v1/divisions`
- **Mô tả:** Lấy danh sách tất cả phòng ban giám sát
- **Query Parameters:**
  - `page` (number, optional): Số trang (mặc định: 1)
  - `size` (number, optional): Kích thước trang (mặc định: 20, tối đa: 100)
  - `search` (string, optional): Tìm kiếm theo tên phòng ban
  - `sort` (string, optional): Sắp xếp (mặc định: divisionName,asc)

**Response Data Type:**
```typescript
interface Division {
  divisionId: number;
  divisionName: string;
  field1?: string;
  createdAt: string;
  updatedAt: string;
}

interface DivisionListResponse {
  success: true;
  data: Division[];
  message: "Lấy danh sách phòng ban giám sát thành công";
  pagination: {
    page: number;
    size: number;
    totalElements: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

**Example Response:**
```json
{
  "success": true,
  "data": [
    {
      "divisionId": 1,
      "divisionName": "Phòng Kỹ thuật",
      "field1": "TECH",
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    },
    {
      "divisionId": 2,
      "divisionName": "Phòng Kinh doanh",
      "field1": "SALES",
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "message": "Lấy danh sách phòng ban giám sát thành công",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 2,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

### 2.2. Lấy thông tin phòng ban giám sát theo ID
- **API Call:** `GET /api/v1/divisions/{divisionId}`
- **Mô tả:** Lấy thông tin chi tiết một phòng ban giám sát
- **Path Parameters:**
  - `divisionId` (number, required): ID phòng ban giám sát

**Response Data Type:**
```typescript
interface DivisionDetailResponse {
  success: true;
  data: Division;
  message: "Lấy thông tin phòng ban giám sát thành công";
}
```

### 2.3. Tạo phòng ban giám sát mới
- **API Call:** `POST /api/v1/divisions`
- **Mô tả:** Tạo phòng ban giám sát mới
- **Request Data Type:**
```typescript
interface CreateDivisionRequest {
  divisionName: string;
  field1?: string;
}
```

**Response Data Type:**
```typescript
interface CreateDivisionResponse {
  success: true;
  data: Division;
  message: "Tạo phòng ban giám sát thành công";
}
```

### 2.4. Cập nhật phòng ban giám sát
- **API Call:** `PUT /api/v1/divisions/{divisionId}`
- **Mô tả:** Cập nhật thông tin phòng ban giám sát
- **Path Parameters:**
  - `divisionId` (number, required): ID phòng ban giám sát
- **Request Data Type:**
```typescript
interface UpdateDivisionRequest {
  divisionName: string;
  field1?: string;
}
```

**Response Data Type:**
```typescript
interface UpdateDivisionResponse {
  success: true;
  data: Division;
  message: "Cập nhật phòng ban giám sát thành công";
}
```

### 2.5. Xóa phòng ban giám sát
- **API Call:** `DELETE /api/v1/divisions/{divisionId}`
- **Mô tả:** Xóa phòng ban giám sát (soft delete)
- **Path Parameters:**
  - `divisionId` (number, required): ID phòng ban giám sát

**Response Data Type:**
```typescript
interface DeleteDivisionResponse {
  success: true;
  data: null;
  message: "Xóa phòng ban giám sát thành công";
}
```

---

## 3. Error Responses

### 3.1. Validation Error
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "code": "DIV_001",
  "message": "Dữ liệu đầu vào không hợp lệ",
  "details": [
    {
      "field": "divisionName",
      "message": "Tên phòng ban là bắt buộc",
      "code": "FIELD_REQUIRED"
    }
  ]
}
```

### 3.2. Not Found Error
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "code": "DIV_002",
  "message": "Không tìm thấy phòng ban giám sát",
  "details": []
}
```

### 3.3. Conflict Error
```json
{
  "success": false,
  "error": "CONFLICT",
  "code": "DIV_003",
  "message": "Tên phòng ban đã tồn tại",
  "details": []
}
```

---

## 4. Business Rules

### 4.1. Validation Rules
- **divisionName:** Bắt buộc, tối đa 100 ký tự
- **field1:** Tùy chọn, tối đa 50 ký tự
- **Tên phòng ban:** Phải duy nhất trong hệ thống

### 4.2. Constraints
- Không thể xóa phòng ban giám sát nếu còn phòng ban con
- Soft delete: Đặt `deletedAt` thay vì xóa thật

### 4.3. Permissions
- **hr:read:** Xem danh sách và chi tiết
- **hr:write:** Tạo, cập nhật phòng ban giám sát
- **hr:admin:** Xóa phòng ban giám sát

---

## 5. Database Schema

### 5.1. Table Structure
```sql
CREATE TABLE T_統括部門 (
    部門ID NUMBER(10) PRIMARY KEY,
    統括部門 VARCHAR2(100 CHAR),
    フィールド1 VARCHAR2(50 CHAR)
);
```

### 5.2. Indexes
- `IDX_統括部門_統括部門` on `T_統括部門(統括部門)`

---

## 6. Performance Considerations

### 6.1. Caching
- Cache danh sách phòng ban giám sát trong 1 giờ
- Invalidate cache khi có thay đổi

### 6.2. Pagination
- Mặc định 20 items per page
- Tối đa 100 items per page
- Sử dụng OFFSET/LIMIT cho Oracle

---

## 7. Testing Scenarios

### 7.1. Happy Path
1. Lấy danh sách phòng ban giám sát thành công
2. Tạo phòng ban giám sát mới thành công
3. Cập nhật thông tin phòng ban giám sát thành công
4. Xóa phòng ban giám sát thành công

### 7.2. Error Cases
1. Tạo phòng ban với tên trùng lặp
2. Cập nhật phòng ban không tồn tại
3. Xóa phòng ban còn phòng ban con
4. Validation lỗi khi thiếu thông tin bắt buộc

---

*API này tuân thủ các quy tắc RESTful và tiêu chuẩn trong README.md*
