# 7. API Phụ Cấp Chứng Chỉ (資格手当)

**Phiên bản:** v0.1  
**Ngày cập nhật:** 2025-10-25  
**Tác giả:** Chính  
**Người kiểm duyệt:** [PM/Leader Name]  
**Hệ thống:** Quản lý Nhân sự  

---

## 1. Tổng quan
API quản lý thông tin phụ cấp chứng chỉ (資格手当) - bảng master cho các loại phụ cấp bằng cấp.

**Database Table:** `T_資格手当`

---

## 2. Endpoints

### 2.1. Lấy danh sách phụ cấp chứng chỉ
- **API Call:** `GET /api/v1/qualification-allowances`
- **Mô tả:** Lấy danh sách tất cả phụ cấp chứng chỉ
- **Query Parameters:**
  - `page` (number, optional): Số trang (mặc định: 1)
  - `size` (number, optional): Kích thước trang (mặc định: 20, tối đa: 100)
  - `search` (string, optional): Tìm kiếm theo tên chứng chỉ
  - `type` (string, optional): Lọc theo loại chứng chỉ
  - `grade` (string, optional): Lọc theo cấp bậc
  - `sort` (string, optional): Sắp xếp (mặc định: name,asc)

**Response Data Type:**
```typescript
interface QualificationAllowance {
  qualificationId: number;
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
  createdAt: string;
  updatedAt: string;
}

interface QualificationAllowanceListResponse {
  success: true;
  data: QualificationAllowance[];
  message: "Lấy danh sách phụ cấp chứng chỉ thành công";
  pagination: {
    page: number;
    size: number;
    totalElements: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

**Example Response:**
```json
{
  "success": true,
  "data": [
    {
      "qualificationId": 1,
      "name": "Chứng chỉ Kỹ sư Cơ khí",
      "grade": "Cấp 1",
      "type": "Kỹ thuật",
      "allowanceAmount": 500000,
      "remarks": "Phụ cấp hàng tháng",
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    },
    {
      "qualificationId": 2,
      "name": "Chứng chỉ An toàn Lao động",
      "grade": "Cấp 2",
      "type": "An toàn",
      "allowanceAmount": 300000,
      "remarks": "Phụ cấp hàng tháng",
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "message": "Lấy danh sách phụ cấp chứng chỉ thành công",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 2,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

### 2.2. Lấy thông tin phụ cấp chứng chỉ theo ID
- **API Call:** `GET /api/v1/qualification-allowances/{qualificationId}`
- **Mô tả:** Lấy thông tin chi tiết một phụ cấp chứng chỉ
- **Path Parameters:**
  - `qualificationId` (number, required): ID phụ cấp chứng chỉ

**Response Data Type:**
```typescript
interface QualificationAllowanceDetailResponse {
  success: true;
  data: QualificationAllowance;
  message: "Lấy thông tin phụ cấp chứng chỉ thành công";
}
```

### 2.3. Tạo phụ cấp chứng chỉ mới
- **API Call:** `POST /api/v1/qualification-allowances`
- **Mô tả:** Tạo phụ cấp chứng chỉ mới
- **Request Data Type:**
```typescript
interface CreateQualificationAllowanceRequest {
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
}
```

**Response Data Type:**
```typescript
interface CreateQualificationAllowanceResponse {
  success: true;
  data: QualificationAllowance;
  message: "Tạo phụ cấp chứng chỉ thành công";
}
```

### 2.4. Cập nhật phụ cấp chứng chỉ
- **API Call:** `PUT /api/v1/qualification-allowances/{qualificationId}`
- **Mô tả:** Cập nhật thông tin phụ cấp chứng chỉ
- **Path Parameters:**
  - `qualificationId` (number, required): ID phụ cấp chứng chỉ
- **Request Data Type:**
```typescript
interface UpdateQualificationAllowanceRequest {
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
}
```

**Response Data Type:**
```typescript
interface UpdateQualificationAllowanceResponse {
  success: true;
  data: QualificationAllowance;
  message: "Cập nhật phụ cấp chứng chỉ thành công";
}
```

### 2.5. Xóa phụ cấp chứng chỉ
- **API Call:** `DELETE /api/v1/qualification-allowances/{qualificationId}`
- **Mô tả:** Xóa phụ cấp chứng chỉ (soft delete)
- **Path Parameters:**
  - `qualificationId` (number, required): ID phụ cấp chứng chỉ

**Response Data Type:**
```typescript
interface DeleteQualificationAllowanceResponse {
  success: true;
  data: null;
  message: "Xóa phụ cấp chứng chỉ thành công";
}
```

---

## 3. Error Responses

### 3.1. Validation Error
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "code": "QA_001",
  "message": "Dữ liệu đầu vào không hợp lệ",
  "details": [
    {
      "field": "name",
      "message": "Tên chứng chỉ là bắt buộc",
      "code": "FIELD_REQUIRED"
    },
    {
      "field": "allowanceAmount",
      "message": "Số tiền phụ cấp phải lớn hơn 0",
      "code": "INVALID_AMOUNT"
    }
  ]
}
```

### 3.2. Not Found Error
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "code": "QA_002",
  "message": "Không tìm thấy phụ cấp chứng chỉ",
  "details": []
}
```

### 3.3. Conflict Error
```json
{
  "success": false,
  "error": "CONFLICT",
  "code": "QA_003",
  "message": "Tên chứng chỉ đã tồn tại",
  "details": []
}
```

---

## 4. Business Rules

### 4.1. Validation Rules
- **name:** Bắt buộc, tối đa 100 ký tự
- **grade:** Bắt buộc, tối đa 50 ký tự
- **type:** Bắt buộc, tối đa 50 ký tự
- **allowanceAmount:** Bắt buộc, phải > 0
- **remarks:** Tùy chọn, tối đa 255 ký tự
- **Tên chứng chỉ:** Phải duy nhất trong hệ thống

### 4.2. Constraints
- Không thể xóa phụ cấp chứng chỉ nếu còn nhân viên sử dụng
- Soft delete: Đặt `deletedAt` thay vì xóa thật

### 4.3. Permissions
- **hr:read:** Xem danh sách và chi tiết
- **hr:write:** Tạo, cập nhật phụ cấp chứng chỉ
- **hr:admin:** Xóa phụ cấp chứng chỉ

---

## 5. Database Schema

### 5.1. Table Structure
```sql
CREATE TABLE T_資格手当 (
    資格ID NUMBER(10) PRIMARY KEY,
    名称 VARCHAR2(100 CHAR),
    等級 VARCHAR2(50 CHAR),
    種類 VARCHAR2(50 CHAR),
    金額 NUMBER(10, 2),
    備考 VARCHAR2(255 CHAR)
);
```

### 5.2. Indexes
- `IDX_資格手当_名称` on `T_資格手当(名称)`
- `IDX_資格手当_種類` on `T_資格手当(種類)`

---

## 6. Performance Considerations

### 6.1. Caching
- Cache danh sách phụ cấp chứng chỉ trong 30 phút
- Invalidate cache khi có thay đổi

### 6.2. Pagination
- Mặc định 20 items per page
- Tối đa 100 items per page
- Sử dụng OFFSET/LIMIT cho Oracle

---

## 7. Testing Scenarios

### 7.1. Happy Path
1. Lấy danh sách phụ cấp chứng chỉ thành công
2. Tạo phụ cấp chứng chỉ mới thành công
3. Cập nhật thông tin phụ cấp chứng chỉ thành công
4. Xóa phụ cấp chứng chỉ thành công

### 7.2. Error Cases
1. Tạo phụ cấp với tên trùng lặp
2. Cập nhật phụ cấp không tồn tại
3. Xóa phụ cấp còn nhân viên sử dụng
4. Validation lỗi khi thiếu thông tin bắt buộc

---

*API này tuân thủ các quy tắc RESTful và tiêu chuẩn trong README.md*
