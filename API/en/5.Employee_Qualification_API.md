# 4. Employee Qualification API
**Version:** v0.1  
**Last Updated:** 2025-10-25  
**Author:** Chinh  
**Reviewer:** [PM/Leader Name]  
**System:** HR Management System  

---

## Overview
API for managing employee qualifications (T_資格). Provides functionality to manage employee qualification records, including qualification information, acquisition dates, certificate numbers, and check status.

## Base URL
`/api/v1/qualifications/employees`

## Authentication
Bearer Token required for all endpoints

## RESTful API Design Principles
- **Resource-based URLs**: Use nouns, not verbs
- **HTTP Methods**: GET, POST, PUT, DELETE, PATCH
- **Status Codes**: Proper HTTP status codes
- **Stateless**: Each request contains all necessary information
- **Cacheable**: GET requests are cacheable
- **Uniform Interface**: Consistent API design across all resources

## Data Models

### Employee Qualification Entity
```json
{
  "id": "number",                     // ID (Primary Key)
  "employeeCode": "string",           // Employee Code (Foreign Key)
  "name": "string",                   // Name
  "grade": "string",                  // Grade
  "type": "string",                   // Type
  "amount": "number",                 // Amount
  "isChecked": "boolean",            // Check Status
  "certificateNumber": "string",      // Certificate Number
  "acquisitionDate": "date",          // Acquisition Date
  "qualificationTypeId": "number"     // Qualification Type ID (Foreign Key)
}
```

## Endpoints

### 1. Get Employee Qualifications
**GET** `/api/v1/qualifications/employees/{employeeCode}`

#### Path Parameters
- `employeeCode`: Employee code

#### Query Parameters
- `year` (optional): Filter by acquisition year
- `type` (optional): Filter by qualification type

#### Response
```json
{
  "data": [
    {
      "id": 1,
      "employeeCode": "EMP001",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "isChecked": true,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    },
    {
      "id": 2,
      "employeeCode": "EMP001",
      "name": "応用情報技術者",
      "grade": "応用",
      "type": "国家資格",
      "amount": 8000.00,
      "isChecked": false,
      "certificateNumber": "AP2024001",
      "acquisitionDate": "2024-06-20",
      "qualificationTypeId": 2
    }
  ]
}
```

### 2. Get Employee Qualification by ID
**GET** `/api/v1/qualifications/employees/record/{id}`

#### Path Parameters
- `id`: Qualification record ID

#### Response
```json
{
  "data": {
    "id": 1,
    "employeeCode": "EMP001",
    "name": "基本情報技術者",
    "grade": "基本",
    "type": "国家資格",
    "amount": 5000.00,
    "isChecked": true,
    "certificateNumber": "FE2024001",
    "acquisitionDate": "2024-03-15",
    "qualificationTypeId": 1
  }
}
```

### 3. Create Employee Qualification
**POST** `/api/v1/qualifications/employees`

#### Request Body
```json
{
  "employeeCode": "EMP001",
  "name": "データベーススペシャリスト",
  "grade": "専門",
  "type": "国家資格",
  "amount": 10000.00,
  "isChecked": true,
  "certificateNumber": "DB2024001",
  "acquisitionDate": "2024-09-10",
  "qualificationTypeId": 3
}
```

#### Response
```json
{
  "success": true,
  "message": "Employee qualification created successfully",
  "data": {
    "id": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 4. Update Employee Qualification
**PUT** `/api/v1/qualifications/employees/{id}`

#### Path Parameters
- `id`: Qualification record ID

#### Request Body
```json
{
  "name": "データベーススペシャリスト（更新）",
  "grade": "専門",
  "type": "国家資格",
  "amount": 12000.00,
  "isChecked": true,
  "certificateNumber": "DB2024001",
  "acquisitionDate": "2024-09-10",
  "qualificationTypeId": 3
}
```

#### Response
```json
{
  "success": true,
  "message": "Employee qualification updated successfully",
  "data": {
    "id": 3,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 5. Delete Employee Qualification
**DELETE** `/api/v1/qualifications/employees/{id}`

#### Path Parameters
- `id`: Qualification record ID

#### Response
```json
{
  "success": true,
  "message": "Employee qualification deleted successfully"
}
```

### 6. Get Qualification Statistics
**GET** `/api/v1/qualifications/employees/statistics`

#### Query Parameters
- `divisionId` (optional): Filter by division
- `departmentId` (optional): Filter by department
- `year` (optional): Filter by year

#### Response
```json
{
  "data": {
    "totalQualifications": 150,
    "qualificationsByType": [
      {
        "type": "国家資格",
        "count": 80,
        "percentage": 53.3
      },
      {
        "type": "民間資格",
        "count": 70,
        "percentage": 46.7
      }
    ],
    "qualificationsByGrade": [
      {
        "grade": "基本",
        "count": 60,
        "percentage": 40.0
      },
      {
        "grade": "応用",
        "count": 50,
        "percentage": 33.3
      },
      {
        "grade": "専門",
        "count": 40,
        "percentage": 26.7
      }
    ],
    "totalAllowanceAmount": 750000.00
  }
}
```

### 7. Search Employee Qualifications
**GET** `/api/v1/qualifications/employees/search`

#### Query Parameters
- `keyword` (required): Search keyword
- `type` (optional): Filter by qualification type
- `grade` (optional): Filter by grade
- `employeeCode` (optional): Filter by employee

#### Response
```json
{
  "data": [
    {
      "id": 1,
      "employeeCode": "EMP001",
      "employeeName": "田中太郎",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "acquisitionDate": "2024-03-15"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 25,
    "totalPages": 2
  }
}
```

### 8. Bulk Import Employee Qualifications
**POST** `/api/v1/qualifications/employees/import`

#### Request Body
```json
{
  "qualifications": [
    {
      "employeeCode": "EMP001",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    },
    {
      "employeeCode": "EMP002",
      "name": "応用情報技術者",
      "grade": "応用",
      "type": "国家資格",
      "amount": 8000.00,
      "certificateNumber": "AP2024002",
      "acquisitionDate": "2024-04-20",
      "qualificationTypeId": 2
    }
  ]
}
```

#### Response
```json
{
  "success": true,
  "message": "Employee qualifications imported successfully",
  "data": {
    "importedCount": 2,
    "failedCount": 0,
    "errors": []
  }
}
```

### 9. Update Check Status
**PATCH** `/api/v1/qualifications/employees/{id}/check`

#### Path Parameters
- `id`: Qualification record ID

#### Request Body
```json
{
  "isChecked": true
}
```

#### Response
```json
{
  "success": true,
  "message": "Check status updated successfully",
  "data": {
    "id": 1,
    "isChecked": true,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

## Error Responses

### 400 Bad Request
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "Invalid input data",
  "details": [
    {
      "field": "employeeCode",
      "message": "Employee code is required"
    }
  ]
}
```

### 404 Not Found
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "message": "Employee qualification not found"
}
```

### 409 Conflict
```json
{
  "success": false,
  "error": "CONFLICT",
  "message": "Employee qualification already exists for this employee"
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": "INTERNAL_ERROR",
  "message": "An unexpected error occurred"
}
```

## Business Rules

1. **Employee Qualification**: Employee code must reference existing employee
2. **Amount Validation**: Amount must be positive number
3. **Date Validation**: Acquisition date cannot be in the future
4. **Certificate Number**: Must be unique within the same qualification type
5. **Check Status**: Can only be true if acquisition date is set
6. **Employee Code**: Must exist in the system
7. **Qualification Type ID**: Must reference existing qualification allowance

## Database Constraints

- Primary Key: `ID`
- Foreign Keys: 
  - `T_資格.社員コード` → `T_社員マスタ.社員コード`
  - `T_資格.資格ID` → `T_資格手当.資格ID`
- Unique constraints for certificate numbers
- Check constraints for amount validation
- Check constraints for acquisition date

## Usage Examples

### Get qualifications for specific employee
```bash
curl -X GET "https://api.company.com/api/v1/qualifications/employees/EMP001" \
  -H "Authorization: Bearer your-token"
```

### Create new employee qualification
```bash
curl -X POST "https://api.company.com/api/v1/qualifications/employees" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "employeeCode": "EMP001",
    "name": "新資格",
    "grade": "基本",
    "type": "国家資格",
    "amount": 5000.00,
    "isChecked": false,
    "certificateNumber": "NEW2024001",
    "acquisitionDate": "2024-01-15",
    "qualificationTypeId": 1
  }'
```

### Search employee qualifications
```bash
curl -X GET "https://api.company.com/api/v1/qualifications/employees/search?keyword=情報技術" \
  -H "Authorization: Bearer your-token"
```

### Update check status
```bash
curl -X PATCH "https://api.company.com/api/v1/qualifications/employees/1/check" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "isChecked": true
  }'
```

---

*This API documentation is part of the Employee Management System*
