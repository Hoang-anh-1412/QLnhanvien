# 7. Qualification Allowance API (資格手当)

**Version:** v0.1  
**Last Updated:** 2025-10-25  
**Author:** Chính  
**Reviewer:** [PM/Leader Name]  
**System:** HR Management  

---

## 1. Overview
API for managing qualification allowances (資格手当) - master table for qualification allowance types.

**Database Table:** `T_資格手当`

---

## 2. Endpoints

### 2.1. Get Qualification Allowance List
- **API Call:** `GET /api/v1/qualification-allowances`
- **Description:** Get list of all qualification allowances
- **Query Parameters:**
  - `page` (number, optional): Page number (default: 1)
  - `size` (number, optional): Page size (default: 20, max: 100)
  - `search` (string, optional): Search by qualification name
  - `type` (string, optional): Filter by qualification type
  - `grade` (string, optional): Filter by grade level
  - `sort` (string, optional): Sort order (default: name,asc)

**Response Data Type:**
```typescript
interface QualificationAllowance {
  qualificationId: number;
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
  createdAt: string;
  updatedAt: string;
}

interface QualificationAllowanceListResponse {
  success: true;
  data: QualificationAllowance[];
  message: "Qualification allowance list retrieved successfully";
  pagination: {
    page: number;
    size: number;
    totalElements: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

**Example Response:**
```json
{
  "success": true,
  "data": [
    {
      "qualificationId": 1,
      "name": "Mechanical Engineer Certificate",
      "grade": "Level 1",
      "type": "Technical",
      "allowanceAmount": 500000,
      "remarks": "Monthly allowance",
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    },
    {
      "qualificationId": 2,
      "name": "Occupational Safety Certificate",
      "grade": "Level 2",
      "type": "Safety",
      "allowanceAmount": 300000,
      "remarks": "Monthly allowance",
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "message": "Qualification allowance list retrieved successfully",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 2,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

### 2.2. Get Qualification Allowance by ID
- **API Call:** `GET /api/v1/qualification-allowances/{qualificationId}`
- **Description:** Get detailed information of a qualification allowance
- **Path Parameters:**
  - `qualificationId` (number, required): Qualification allowance ID

**Response Data Type:**
```typescript
interface QualificationAllowanceDetailResponse {
  success: true;
  data: QualificationAllowance;
  message: "Qualification allowance details retrieved successfully";
}
```

### 2.3. Create New Qualification Allowance
- **API Call:** `POST /api/v1/qualification-allowances`
- **Description:** Create a new qualification allowance
- **Request Data Type:**
```typescript
interface CreateQualificationAllowanceRequest {
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
}
```

**Response Data Type:**
```typescript
interface CreateQualificationAllowanceResponse {
  success: true;
  data: QualificationAllowance;
  message: "Qualification allowance created successfully";
}
```

### 2.4. Update Qualification Allowance
- **API Call:** `PUT /api/v1/qualification-allowances/{qualificationId}`
- **Description:** Update qualification allowance information
- **Path Parameters:**
  - `qualificationId` (number, required): Qualification allowance ID
- **Request Data Type:**
```typescript
interface UpdateQualificationAllowanceRequest {
  name: string;
  grade: string;
  type: string;
  allowanceAmount: number;
  remarks?: string;
}
```

**Response Data Type:**
```typescript
interface UpdateQualificationAllowanceResponse {
  success: true;
  data: QualificationAllowance;
  message: "Qualification allowance updated successfully";
}
```

### 2.5. Delete Qualification Allowance
- **API Call:** `DELETE /api/v1/qualification-allowances/{qualificationId}`
- **Description:** Delete qualification allowance (soft delete)
- **Path Parameters:**
  - `qualificationId` (number, required): Qualification allowance ID

**Response Data Type:**
```typescript
interface DeleteQualificationAllowanceResponse {
  success: true;
  data: null;
  message: "Qualification allowance deleted successfully";
}
```

---

## 3. Error Responses

### 3.1. Validation Error
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "code": "QA_001",
  "message": "Invalid input data",
  "details": [
    {
      "field": "name",
      "message": "Qualification name is required",
      "code": "FIELD_REQUIRED"
    },
    {
      "field": "allowanceAmount",
      "message": "Allowance amount must be greater than 0",
      "code": "INVALID_AMOUNT"
    }
  ]
}
```

### 3.2. Not Found Error
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "code": "QA_002",
  "message": "Qualification allowance not found",
  "details": []
}
```

### 3.3. Conflict Error
```json
{
  "success": false,
  "error": "CONFLICT",
  "code": "QA_003",
  "message": "Qualification name already exists",
  "details": []
}
```

---

## 4. Business Rules

### 4.1. Validation Rules
- **name:** Required, max 100 characters
- **grade:** Required, max 50 characters
- **type:** Required, max 50 characters
- **allowanceAmount:** Required, must be > 0
- **remarks:** Optional, max 255 characters
- **Qualification name:** Must be unique in the system

### 4.2. Constraints
- Cannot delete qualification allowance if employees are using it
- Soft delete: Set `deletedAt` instead of hard delete

### 4.3. Permissions
- **hr:read:** View list and details
- **hr:write:** Create, update qualification allowances
- **hr:admin:** Delete qualification allowances

---

## 5. Database Schema

### 5.1. Table Structure
```sql
CREATE TABLE T_資格手当 (
    資格ID NUMBER(10) PRIMARY KEY,
    名称 VARCHAR2(100 CHAR),
    等級 VARCHAR2(50 CHAR),
    種類 VARCHAR2(50 CHAR),
    金額 NUMBER(10, 2),
    備考 VARCHAR2(255 CHAR)
);
```

### 5.2. Indexes
- `IDX_資格手当_名称` on `T_資格手当(名称)`
- `IDX_資格手当_種類` on `T_資格手当(種類)`

---

## 6. Performance Considerations

### 6.1. Caching
- Cache qualification allowance list for 30 minutes
- Invalidate cache on changes

### 6.2. Pagination
- Default 20 items per page
- Maximum 100 items per page
- Use OFFSET/LIMIT for Oracle

---

## 7. Testing Scenarios

### 7.1. Happy Path
1. Get qualification allowance list successfully
2. Create new qualification allowance successfully
3. Update qualification allowance information successfully
4. Delete qualification allowance successfully

### 7.2. Error Cases
1. Create qualification allowance with duplicate name
2. Update non-existent qualification allowance
3. Delete qualification allowance in use by employees
4. Validation error when missing required fields

---

*This API follows RESTful rules and standards in README.md*
