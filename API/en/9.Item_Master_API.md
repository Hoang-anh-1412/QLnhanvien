# 9. Item Master API (品目マスター)

**Version:** v0.1  
**Last Updated:** 2025-10-25  
**Author:** Chính  
**Reviewer:** [PM/Leader Name]  
**System:** HR Management  

---

## 1. Overview
API for managing work uniform product catalog (品目マスター) - manages product information, sizes, colors and pricing.

**Database Table:** `T_品目マスター` (needs to be created)

---

## 2. Endpoints

### 2.1. Get Item List
- **API Call:** `GET /api/v1/items`
- **Description:** Get list of all work uniform items
- **Query Parameters:**
  - `page` (number, optional): Page number (default: 1)
  - `size` (number, optional): Page size (default: 20, max: 100)
  - `search` (string, optional): Search by item name
  - `category` (string, optional): Filter by category
  - `isActive` (boolean, optional): Filter by active status
  - `sort` (string, optional): Sort order (default: itemName,asc)

**Response Data Type:**
```typescript
interface Item {
  itemCode: string;
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}

interface ItemListResponse {
  success: true;
  data: Item[];
  message: "Item list retrieved successfully";
  pagination: {
    page: number;
    size: number;
    totalElements: number;
    totalPages: number;
    hasNext: boolean;
    hasPrevious: boolean;
  };
}
```

**Example Response:**
```json
{
  "success": true,
  "data": [
    {
      "itemCode": "UF001",
      "itemName": "作業服 上下セット",
      "category": "作業服",
      "description": "標準的な作業服上下セット",
      "availableSizes": ["S", "M", "L", "XL", "XXL"],
      "availableColors": ["ネイビー", "グレー", "ブラック"],
      "unitPrice": 75000,
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    },
    {
      "itemCode": "UF002",
      "itemName": "安全靴",
      "category": "靴",
      "description": "安全基準準拠の作業靴",
      "availableSizes": ["24", "25", "26", "27", "28", "29", "30"],
      "availableColors": ["ブラック", "ブラウン"],
      "unitPrice": 25000,
      "isActive": true,
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "message": "Item list retrieved successfully",
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 2,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

### 2.2. Get Item by Code
- **API Call:** `GET /api/v1/items/{itemCode}`
- **Description:** Get detailed information of an item
- **Path Parameters:**
  - `itemCode` (string, required): Item code

**Response Data Type:**
```typescript
interface ItemDetailResponse {
  success: true;
  data: Item;
  message: "Item details retrieved successfully";
}
```

### 2.3. Create New Item
- **API Call:** `POST /api/v1/items`
- **Description:** Create a new work uniform item
- **Request Data Type:**
```typescript
interface CreateItemRequest {
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive?: boolean;
}
```

**Response Data Type:**
```typescript
interface CreateItemResponse {
  success: true;
  data: Item;
  message: "Item created successfully";
}
```

### 2.4. Update Item
- **API Call:** `PUT /api/v1/items/{itemCode}`
- **Description:** Update item information
- **Path Parameters:**
  - `itemCode` (string, required): Item code
- **Request Data Type:**
```typescript
interface UpdateItemRequest {
  itemName: string;
  category: string;
  description?: string;
  availableSizes: string[];
  availableColors: string[];
  unitPrice: number;
  isActive: boolean;
}
```

**Response Data Type:**
```typescript
interface UpdateItemResponse {
  success: true;
  data: Item;
  message: "Item updated successfully";
}
```

### 2.5. Delete Item
- **API Call:** `DELETE /api/v1/items/{itemCode}`
- **Description:** Delete item (soft delete)
- **Path Parameters:**
  - `itemCode` (string, required): Item code

**Response Data Type:**
```typescript
interface DeleteItemResponse {
  success: true;
  data: null;
  message: "Item deleted successfully";
}
```

### 2.6. Update Item Status
- **API Call:** `PATCH /api/v1/items/{itemCode}/status`
- **Description:** Update item active status
- **Path Parameters:**
  - `itemCode` (string, required): Item code
- **Request Data Type:**
```typescript
interface UpdateItemStatusRequest {
  isActive: boolean;
}
```

---

## 3. Error Responses

### 3.1. Validation Error
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "code": "ITEM_001",
  "message": "Invalid input data",
  "details": [
    {
      "field": "itemName",
      "message": "Item name is required",
      "code": "FIELD_REQUIRED"
    },
    {
      "field": "unitPrice",
      "message": "Unit price must be greater than 0",
      "code": "INVALID_PRICE"
    }
  ]
}
```

### 3.2. Not Found Error
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "code": "ITEM_002",
  "message": "Item not found",
  "details": []
}
```

### 3.3. Conflict Error
```json
{
  "success": false,
  "error": "CONFLICT",
  "code": "ITEM_003",
  "message": "Item code already exists",
  "details": []
}
```

---

## 4. Business Rules

### 4.1. Validation Rules
- **itemCode:** Auto-generated, format: UF + 3 digits (UF001, UF002...)
- **itemName:** Required, max 100 characters
- **category:** Required, max 50 characters
- **unitPrice:** Required, must be > 0
- **availableSizes:** Required, at least 1 size
- **availableColors:** Required, at least 1 color

### 4.2. Constraints
- Cannot delete items that are being used in orders
- Soft delete: Set `isActive = false` instead of hard delete
- Item name must be unique within category

### 4.3. Permissions
- **hr:read:** View item list and details
- **hr:write:** Create, update items
- **hr:admin:** Delete items, update status

---

## 5. Database Schema

### 5.1. Table Structure
```sql
CREATE TABLE T_品目マスター (
    商品コード VARCHAR2(50 CHAR) PRIMARY KEY,
    商品名 VARCHAR2(100 CHAR),
    カテゴリ VARCHAR2(50 CHAR),
    説明 VARCHAR2(255 CHAR),
    利用可能サイズ CLOB, -- JSON array of sizes
    利用可能色 CLOB,     -- JSON array of colors
    単価 NUMBER(10, 2),
    有効フラグ NUMBER(1) DEFAULT 1,
    作成日時 TIMESTAMP,
    更新日時 TIMESTAMP
);

-- Sequence for auto-generating item codes
CREATE SEQUENCE SEQ_品目マスター_コード
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;
```

### 5.2. Indexes
- `IDX_品目マスター_商品名` on `T_品目マスター(商品名)`
- `IDX_品目マスター_カテゴリ` on `T_品目マスター(カテゴリ)`
- `IDX_品目マスター_有効フラグ` on `T_品目マスター(有効フラグ)`

---

## 6. Performance Considerations

### 6.1. Caching
- Cache item list for 1 hour
- Invalidate cache on changes

### 6.2. Pagination
- Default 20 items per page
- Maximum 100 items per page
- Use OFFSET/LIMIT for Oracle

---

## 7. Testing Scenarios

### 7.1. Happy Path
1. Get item list successfully
2. Create new item successfully
3. Update item successfully
4. Update item status successfully

### 7.2. Error Cases
1. Create item with duplicate name
2. Update non-existent item
3. Delete item being used in orders
4. Validation error when missing required fields

---

*This API follows RESTful rules and standards in README.md*
