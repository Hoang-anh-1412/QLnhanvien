# 3. Qualification API
**Version:** v0.1  
**Last Updated:** 2025-10-25  
**Author:** Chinh  
**Reviewer:** [PM/Leader Name]  
**System:** HR Management System  

---

## Overview
API for managing qualification data including qualification allowances (T_資格手当) and employee qualifications (T_資格). Provides comprehensive qualification management functionality.

## Base URL
`/api/v1/qualifications`

## Authentication
Bearer Token required for all endpoints

## RESTful API Design Principles
- **Resource-based URLs**: Use nouns, not verbs
- **HTTP Methods**: GET, POST, PUT, DELETE, PATCH
- **Status Codes**: Proper HTTP status codes
- **Stateless**: Each request contains all necessary information
- **Cacheable**: GET requests are cacheable
- **Uniform Interface**: Consistent API design across all resources

## Data Models

### Qualification Allowance Entity
```json
{
  "qualificationId": "number",        // 資格ID (Primary Key)
  "name": "string",                   // 名称
  "grade": "string",                  // 等級
  "type": "string",                   // 種類
  "amount": "number",                 // 金額
  "remarks": "string"                 // 備考
}
```

### Employee Qualification Entity
```json
{
  "id": "number",                     // ID (Primary Key)
  "employeeCode": "string",           // 社員コード (Foreign Key)
  "name": "string",                   // 名称
  "grade": "string",                  // 等級
  "type": "string",                   // 種類
  "amount": "number",                 // 金額
  "isChecked": "boolean",             // チェック
  "certificateNumber": "string",      // 番号
  "acquisitionDate": "date",          // 取得日
  "qualificationTypeId": "number"     // 資格ID (Foreign Key)
}
```

## Endpoints

### 1. Get All Qualification Allowances
**GET** `/api/v1/qualifications/allowances`

#### Query Parameters
- `page` (optional): Page number (default: 1)
- `size` (optional): Page size (default: 20)
- `name` (optional): Filter by qualification name
- `type` (optional): Filter by qualification type

#### Response
```json
{
  "data": [
    {
      "qualificationId": 1,
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "remarks": "IT関連の基本資格"
    },
    {
      "qualificationId": 2,
      "name": "応用情報技術者",
      "grade": "応用",
      "type": "国家資格",
      "amount": 8000.00,
      "remarks": "IT関連の応用資格"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 50,
    "totalPages": 3
  }
}
```

### 2. Get Qualification Allowance by ID
**GET** `/api/v1/qualifications/allowances/{qualificationId}`

#### Path Parameters
- `qualificationId`: Qualification ID

#### Response
```json
{
  "data": {
    "qualificationId": 1,
    "name": "基本情報技術者",
    "grade": "基本",
    "type": "国家資格",
    "amount": 5000.00,
    "remarks": "IT関連の基本資格"
  }
}
```

### 3. Create Qualification Allowance
**POST** `/api/v1/qualifications/allowances`

#### Request Body
```json
{
  "name": "データベーススペシャリスト",
  "grade": "専門",
  "type": "国家資格",
  "amount": 10000.00,
  "remarks": "データベース専門資格"
}
```

#### Response
```json
{
  "success": true,
  "message": "Qualification allowance created successfully",
  "data": {
    "qualificationId": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 4. Update Qualification Allowance
**PUT** `/api/v1/qualifications/allowances/{qualificationId}`

#### Path Parameters
- `qualificationId`: Qualification ID

#### Request Body
```json
{
  "name": "データベーススペシャリスト（更新）",
  "grade": "専門",
  "type": "国家資格",
  "amount": 12000.00,
  "remarks": "データベース専門資格（更新）"
}
```

#### Response
```json
{
  "success": true,
  "message": "Qualification allowance updated successfully",
  "data": {
    "qualificationId": 3,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 5. Delete Qualification Allowance
**DELETE** `/api/v1/qualifications/allowances/{qualificationId}`

#### Path Parameters
- `qualificationId`: Qualification ID

#### Response
```json
{
  "success": true,
  "message": "Qualification allowance deleted successfully"
}
```

### 6. Get Employee Qualifications
**GET** `/api/v1/qualifications/employees/{employeeCode}`

#### Path Parameters
- `employeeCode`: Employee code

#### Query Parameters
- `year` (optional): Filter by acquisition year
- `type` (optional): Filter by qualification type

#### Response
```json
{
  "data": [
    {
      "id": 1,
      "employeeCode": "EMP001",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "isChecked": true,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    },
    {
      "id": 2,
      "employeeCode": "EMP001",
      "name": "応用情報技術者",
      "grade": "応用",
      "type": "国家資格",
      "amount": 8000.00,
      "isChecked": false,
      "certificateNumber": "AP2024001",
      "acquisitionDate": "2024-06-20",
      "qualificationTypeId": 2
    }
  ]
}
```

### 7. Create Employee Qualification
**POST** `/api/v1/qualifications/employees`

#### Request Body
```json
{
  "employeeCode": "EMP001",
  "name": "データベーススペシャリスト",
  "grade": "専門",
  "type": "国家資格",
  "amount": 10000.00,
  "isChecked": true,
  "certificateNumber": "DB2024001",
  "acquisitionDate": "2024-09-10",
  "qualificationTypeId": 3
}
```

#### Response
```json
{
  "success": true,
  "message": "Employee qualification created successfully",
  "data": {
    "id": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 8. Update Employee Qualification
**PUT** `/api/v1/qualifications/employees/{id}`

#### Path Parameters
- `id`: Qualification record ID

#### Request Body
```json
{
  "name": "データベーススペシャリスト（更新）",
  "grade": "専門",
  "type": "国家資格",
  "amount": 12000.00,
  "isChecked": true,
  "certificateNumber": "DB2024001",
  "acquisitionDate": "2024-09-10",
  "qualificationTypeId": 3
}
```

#### Response
```json
{
  "success": true,
  "message": "Employee qualification updated successfully",
  "data": {
    "id": 3,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 9. Delete Employee Qualification
**DELETE** `/api/v1/qualifications/employees/{id}`

#### Path Parameters
- `id`: Qualification record ID

#### Response
```json
{
  "success": true,
  "message": "Employee qualification deleted successfully"
}
```

### 10. Get Qualification Statistics
**GET** `/api/v1/qualifications/statistics`

#### Query Parameters
- `divisionId` (optional): Filter by division
- `departmentId` (optional): Filter by department
- `year` (optional): Filter by year

#### Response
```json
{
  "data": {
    "totalQualifications": 150,
    "qualificationsByType": [
      {
        "type": "国家資格",
        "count": 80,
        "percentage": 53.3
      },
      {
        "type": "民間資格",
        "count": 70,
        "percentage": 46.7
      }
    ],
    "qualificationsByGrade": [
      {
        "grade": "基本",
        "count": 60,
        "percentage": 40.0
      },
      {
        "grade": "応用",
        "count": 50,
        "percentage": 33.3
      },
      {
        "grade": "専門",
        "count": 40,
        "percentage": 26.7
      }
    ],
    "totalAllowanceAmount": 750000.00
  }
}
```

### 11. Search Qualifications
**GET** `/api/v1/qualifications/search`

#### Query Parameters
- `keyword` (required): Search keyword
- `type` (optional): Filter by qualification type
- `grade` (optional): Filter by grade
- `employeeCode` (optional): Filter by employee

#### Response
```json
{
  "data": [
    {
      "id": 1,
      "employeeCode": "EMP001",
      "employeeName": "田中太郎",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "acquisitionDate": "2024-03-15"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 25,
    "totalPages": 2
  }
}
```

### 12. Bulk Import Qualifications
**POST** `/api/v1/qualifications/import`

#### Request Body
```json
{
  "qualifications": [
    {
      "employeeCode": "EMP001",
      "name": "基本情報技術者",
      "grade": "基本",
      "type": "国家資格",
      "amount": 5000.00,
      "certificateNumber": "FE2024001",
      "acquisitionDate": "2024-03-15",
      "qualificationTypeId": 1
    },
    {
      "employeeCode": "EMP002",
      "name": "応用情報技術者",
      "grade": "応用",
      "type": "国家資格",
      "amount": 8000.00,
      "certificateNumber": "AP2024002",
      "acquisitionDate": "2024-04-20",
      "qualificationTypeId": 2
    }
  ]
}
```

#### Response
```json
{
  "success": true,
  "message": "Qualifications imported successfully",
  "data": {
    "importedCount": 2,
    "failedCount": 0,
    "errors": []
  }
}
```

## Error Responses

### 400 Bad Request
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "Invalid input data",
  "details": [
    {
      "field": "name",
      "message": "Qualification name is required"
    }
  ]
}
```

### 404 Not Found
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "message": "Qualification not found"
}
```

### 409 Conflict
```json
{
  "success": false,
  "error": "CONFLICT",
  "message": "Qualification already exists for this employee"
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": "INTERNAL_ERROR",
  "message": "An unexpected error occurred"
}
```

## Business Rules

1. **Qualification Allowance**: Must be unique by name and grade combination
2. **Employee Qualification**: Employee code must reference existing employee
3. **Amount Validation**: Amount must be positive number
4. **Date Validation**: Acquisition date cannot be in the future
5. **Certificate Number**: Must be unique within the same qualification type
6. **Check Status**: Can only be true if acquisition date is set

## Database Constraints

- Primary Keys: `資格ID`, `ID`
- Foreign Keys: 
  - `T_資格.社員コード` → `T_社員マスタ.社員コード`
  - `T_資格.資格ID` → `T_資格手当.資格ID`
- Unique constraints for certificate numbers
- Check constraints for amount validation

## Usage Examples

### Get qualifications for specific employee
```bash
curl -X GET "https://api.company.com/api/v1/qualifications/employees/EMP001" \
  -H "Authorization: Bearer your-token"
```

### Create new qualification allowance
```bash
curl -X POST "https://api.company.com/api/v1/qualifications/allowances" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "新資格",
    "grade": "基本",
    "type": "国家資格",
    "amount": 5000.00,
    "remarks": "新しい資格"
  }'
```

### Search qualifications
```bash
curl -X GET "https://api.company.com/api/v1/qualifications/search?keyword=情報技術" \
  -H "Authorization: Bearer your-token"
```

---

*This API documentation is part of the Employee Management System*
