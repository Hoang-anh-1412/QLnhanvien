# 2. Department API
**Version:** v0.1  
**Last Updated:** 2025-10-25  
**Author:** Chinh  
**Reviewer:** [PM/Leader Name]  
**System:** HR Management System  

---

## Overview
API for managing department data including supervising departments (T_統括部門) and department names (T_部署名). Provides hierarchical department management functionality.

## Base URL
`/api/v1/departments`

## Authentication
Bearer Token required for all endpoints

## RESTful API Design Principles
- **Resource-based URLs**: Use nouns, not verbs
- **HTTP Methods**: GET, POST, PUT, DELETE, PATCH
- **Status Codes**: Proper HTTP status codes
- **Stateless**: Each request contains all necessary information
- **Cacheable**: GET requests are cacheable
- **Uniform Interface**: Consistent API design across all resources

## Data Models

### Supervising Department Entity
```json
{
  "divisionId": "number",        // 部門ID (Primary Key)
  "divisionName": "string",      // 統括部門
  "field1": "string"             // フィールド1
}
```

### Department Entity
```json
{
  "departmentId": "string",      // 部署ID (Primary Key)
  "divisionId": "number",        // 部門ID (Foreign Key)
  "departmentName": "string"     // 部署名
}
```

## Endpoints

### 1. Get All Supervising Departments
**GET** `/api/v1/departments/divisions`

#### Response
```json
{
  "data": [
    {
      "divisionId": 1,
      "divisionName": "営業部",
      "field1": "営業関連"
    },
    {
      "divisionId": 2,
      "divisionName": "技術部",
      "field1": "技術関連"
    }
  ]
}
```

### 2. Create Supervising Department
**POST** `/api/v1/departments/divisions`

#### Request Body
```json
{
  "divisionName": "人事部",
  "field1": "人事関連"
}
```

#### Response
```json
{
  "success": true,
  "message": "Supervising department created successfully",
  "data": {
    "divisionId": 3,
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 3. Update Supervising Department
**PUT** `/api/v1/departments/divisions/{divisionId}`

#### Path Parameters
- `divisionId`: Division ID

#### Request Body
```json
{
  "divisionName": "営業企画部",
  "field1": "営業企画関連"
}
```

#### Response
```json
{
  "success": true,
  "message": "Supervising department updated successfully",
  "data": {
    "divisionId": 1,
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 4. Delete Supervising Department
**DELETE** `/api/v1/departments/divisions/{divisionId}`

#### Path Parameters
- `divisionId`: Division ID

#### Response
```json
{
  "success": true,
  "message": "Supervising department deleted successfully"
}
```

### 5. Get All Departments
**GET** `/api/v1/departments`

#### Query Parameters
- `divisionId` (optional): Filter by division ID
- `page` (optional): Page number (default: 1)
- `size` (optional): Page size (default: 20)

#### Response
```json
{
  "data": [
    {
      "departmentId": "DEPT001",
      "divisionId": 1,
      "departmentName": "営業一課",
      "divisionName": "営業部"
    },
    {
      "departmentId": "DEPT002",
      "divisionId": 1,
      "departmentName": "営業二課",
      "divisionName": "営業部"
    }
  ],
  "pagination": {
    "page": 1,
    "size": 20,
    "totalElements": 50,
    "totalPages": 3
  }
}
```

### 6. Get Department by ID
**GET** `/api/v1/departments/{departmentId}`

#### Path Parameters
- `departmentId`: Department ID

#### Response
```json
{
  "data": {
    "departmentId": "DEPT001",
    "divisionId": 1,
    "departmentName": "営業一課",
    "divisionName": "営業部"
  }
}
```

### 7. Create Department
**POST** `/api/v1/departments`

#### Request Body
```json
{
  "departmentId": "DEPT003",
  "divisionId": 2,
  "departmentName": "開発一課"
}
```

#### Response
```json
{
  "success": true,
  "message": "Department created successfully",
  "data": {
    "departmentId": "DEPT003",
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 8. Update Department
**PUT** `/api/v1/departments/{departmentId}`

#### Path Parameters
- `departmentId`: Department ID

#### Request Body
```json
{
  "divisionId": 2,
  "departmentName": "開発企画課"
}
```

#### Response
```json
{
  "success": true,
  "message": "Department updated successfully",
  "data": {
    "departmentId": "DEPT003",
    "updatedAt": "2024-01-15T11:00:00Z"
  }
}
```

### 9. Delete Department
**DELETE** `/api/v1/departments/{departmentId}`

#### Path Parameters
- `departmentId`: Department ID

#### Response
```json
{
  "success": true,
  "message": "Department deleted successfully"
}
```

### 10. Get Departments by Division
**GET** `/api/v1/departments/by-division/{divisionId}`

#### Path Parameters
- `divisionId`: Division ID

#### Response
```json
{
  "data": [
    {
      "departmentId": "DEPT001",
      "departmentName": "営業一課"
    },
    {
      "departmentId": "DEPT002",
      "departmentName": "営業二課"
    }
  ]
}
```

### 11. Get Department Hierarchy
**GET** `/api/v1/departments/hierarchy`

#### Response
```json
{
  "data": [
    {
      "divisionId": 1,
      "divisionName": "営業部",
      "field1": "営業関連",
      "departments": [
        {
          "departmentId": "DEPT001",
          "departmentName": "営業一課"
        },
        {
          "departmentId": "DEPT002",
          "departmentName": "営業二課"
        }
      ]
    },
    {
      "divisionId": 2,
      "divisionName": "技術部",
      "field1": "技術関連",
      "departments": [
        {
          "departmentId": "DEPT003",
          "departmentName": "開発一課"
        }
      ]
    }
  ]
}
```

## Error Responses

### 400 Bad Request
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "Invalid input data",
  "details": [
    {
      "field": "departmentName",
      "message": "Department name is required"
    }
  ]
}
```

### 404 Not Found
```json
{
  "success": false,
  "error": "NOT_FOUND",
  "message": "Department not found"
}
```

### 409 Conflict
```json
{
  "success": false,
  "error": "CONFLICT",
  "message": "Department ID already exists"
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": "INTERNAL_ERROR",
  "message": "An unexpected error occurred"
}
```

## Business Rules

1. **Department ID**: Must be unique across all departments
2. **Division ID**: Must reference an existing supervising department
3. **Cascade Delete**: Deleting a supervising department should handle related departments
4. **Name Validation**: Department and division names cannot be empty
5. **Hierarchy Validation**: Department must belong to a valid division

## Database Constraints

- Primary Keys: `部門ID`, `部署ID`
- Foreign Key: `T_部署名.部門ID` → `T_統括部門.部門ID`
- Unique constraints for department IDs
- Check constraints for name validations

## Usage Examples

### Get all departments with their divisions
```bash
curl -X GET "https://api.company.com/api/v1/departments/hierarchy" \
  -H "Authorization: Bearer your-token"
```

### Create a new department
```bash
curl -X POST "https://api.company.com/api/v1/departments" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "departmentId": "DEPT004",
    "divisionId": 1,
    "departmentName": "営業三課"
  }'
```

### Get departments by division
```bash
curl -X GET "https://api.company.com/api/v1/departments/by-division/1" \
  -H "Authorization: Bearer your-token"
```

---

*This API documentation is part of the Employee Management System*
