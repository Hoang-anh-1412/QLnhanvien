# 2.部署名入力

## ワイヤーフレーム
```
┌─────────────────────────────────────────────────────────┐
│ 🏢 部署名入力 [新規作成] [←戻る]                        │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 統括部門: [営業部 ▼] *必須                          │ │
│ │ 部署名: [________________] *必須                    │ │
│ └─────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│ [💾一時保存] [✅登録] [❌キャンセル]                    │
└─────────────────────────────────────────────────────────┘
```

## 概要
部署名（Department）の新規作成・編集・参照画面。部署情報の入力、一時保存、登録機能を提供する。統括部門との関連付けが必須。

## エンドポイント
`/departments/create` (新規作成)
`/departments/edit/{id}` (編集)
`/departments/view/{id}` (参照)

## 画面背景色
「ライトモード」及び「ダークモード」をボタン切替できるようにする

## 初期表示
### 表示モード
| モード | パラメータ | 説明 |
|:--|:--|:--|
| 新規作成 | mode=create | 新規作成モード（全項目入力可能） |
| 編集 | mode=edit&id={id} | 編集モード（既存データを読み込み） |
| 参照 | mode=view&id={id} | 参照モード（全項目読み取り専用） |

### 共通処理
1. 画面初期化時にモード判定
2. 編集・参照モードの場合、指定IDのデータを取得
3. 取得データをフォームに設定
4. 参照モードの場合、全項目を読み取り専用に設定
5. 統括部門プルダウンのデータを取得・設定

## 各項目の説明

### 1. 統括部門
| 項目 | 値 |
|:--|:--|
| ラベル | 統括部門 |
| 型 | Dropdown |
| 必須 | ○ |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 部署が所属する統括部門を選択 |

#### 統括部門プルダウン
[1.統括部門API](./API/1.統括部門.md)の[getDivisions](./API/1.統括部門.md#getdivisionsパラメータ)クエリを使用

##### リクエストパラメータ
```json
getDivisions(
   request: {
      page: 1,
      size: 1000
   }
)
```

##### プルダウン表示項目
| 表示値 | データソース | 備考 |
|:--|:--|:--|
| 選択してください | - | デフォルト選択肢 |
| 部門名 | division_name | 統括部門の名称 |

#### バリデーション
- 必須チェック: 未選択の場合「統括部門は必須です。」を表示

### 2. 部署名
| 項目 | 値 |
|:--|:--|
| ラベル | 部署名 |
| 型 | String |
| 必須 | ○ |
| 最大文字数 | 50 |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 部署の名称を入力 |

#### バリデーション
- 必須チェック: 未入力の場合「部署名は必須です。」を表示
- 文字数チェック: 50文字を超える場合「部署名は50文字以内で入力してください。」を表示
- 重複チェック: 同一統括部門内で同一部署名が存在する場合「この部署名は既に登録されています。」を表示

## 一時保存処理
### 一時保存ボタン
- バリデーションを実行せずにデータを保存
- 保存成功時: 「一時保存しました。」メッセージ表示
- 保存失敗時: エラーメッセージ表示

### 一時保存API
[2.部署名API](./API/2.部署名.md)の[createDepartment](./API/2.部署名.md#createdepartmentinput)または[updateDepartment](./API/2.部署名.md#updatedepartmentinput)ミューテーションを呼び出し

#### 新規作成時
```json
createDepartment(
   input: {
      division_id: 1,
      department_name: "営業第一課"
   }
)
```

#### 編集時
```json
updateDepartment(
   input: {
      id: 123,
      division_id: 1,
      department_name: "営業第一課"
   }
)
```

## 登録処理
### 登録ボタン
1. 全項目のバリデーション実行
2. バリデーションエラーがある場合: エラーメッセージ表示、処理終了
3. バリデーション成功時: 登録確認モーダル表示

### 登録確認モーダル
#### モーダル内容
- タイトル: "登録確認"
- メッセージ: "部署を登録しますか？"
- ボタン: [キャンセル] [登録実行]

#### 登録実行処理
1. API呼び出し（一時保存と同じAPI）
2. 登録成功時: 成功メッセージ表示、一覧画面に遷移
3. 登録失敗時: エラーメッセージ表示

## 各種チェック

### 1. 必須項目チェック
必須項目が未入力の場合、該当項目にエラーメッセージを表示

### 2. 文字数チェック
各項目の最大文字数を超える場合、エラーメッセージを表示

### 3. 重複チェック
部署名の重複チェック（同一統括部門内）
- 同一統括部門内で同一部署名が存在する場合、エラーメッセージを表示
- 編集時は自身のデータを除外してチェック

### 4. 相関チェック
- 統括部門が選択されている場合のみ、部署名の重複チェックを実行

## 完了メッセージ

### 成功メッセージ
- 一時保存完了: "一時保存しました。"
- 登録完了: "部署を登録しました。"

### エラーメッセージ
- バリデーションエラー: 該当項目にエラーメッセージ表示
- API通信エラー: "データの保存に失敗しました。"
- 重複エラー: "この部署名は既に登録されています。"

## ナビゲーション

### 戻るボタン
- 一覧画面に戻る
- 未保存の変更がある場合: 確認ダイアログ表示

### キャンセルボタン
- 一覧画面に戻る
- 未保存の変更がある場合: 確認ダイアログ表示

## エラーハンドリング

### API エラー
- 通信エラー: "データの取得に失敗しました。"
- 認証エラー: "ログインが必要です。"
- 権限エラー: "この操作を実行する権限がありません。"

### バリデーションエラー
- 必須項目エラー: 該当項目の背景色を変更し、エラーメッセージ表示
- 文字数エラー: 該当項目にエラーメッセージ表示
- 重複エラー: 該当項目にエラーメッセージ表示

## データ取得処理

### 編集・参照モード時のデータ取得
[2.部署名API](./API/2.部署名.md)の[getDepartmentById](./API/2.部署名.md#getdepartmentbyidパラメータ)クエリを使用

#### リクエストパラメータ
```json
getDepartmentById(
   request: {
      id: 123
   }
)
```
- id: 取得対象の部署ID

#### レスポンス処理
- 取得成功時: フォームにデータを設定
- 取得失敗時: エラーメッセージ表示、一覧画面に戻る

## 統括部門プルダウンの更新
### 統括部門データの取得
画面初期表示時に統括部門一覧を取得し、プルダウンに設定

### 更新タイミング
- 画面初期表示時
- 統括部門が追加・編集・削除された時（リアルタイム更新は不要）
