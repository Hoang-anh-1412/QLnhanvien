# 2.資格入力
**バージョン:** v0.1  
**最終更新:** 2025-01-25  
**作成者:** Chinh  
**レビュー担当:** [PM/Leader Name]  
**システム:** 人事管理システム  

---

## 概要
社員の新しい資格情報を入力する画面。詳細な資格情報の入力と社員との関連付け機能を提供する。

- **画面エンドポイント:** `/qualifications/create`
- **背景色:** 緑 (#10B981)、メイン表示エリアは白

## ワイヤーフレーム
```
┌─────────────────────────────────────────────────────────┐
│ 🎓 資格入力 [新規作成] [←戻る]                          │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 社員コード: [EMP001 ▼] *必須                       │ │
│ │ 資格名: [________________] *必須                    │ │
│ │ 等級: [基本 ▼] *必須                               │ │
│ │ 種類: [国家 ▼] *必須                               │ │
│ │ 金額: [¥________] *必須                            │ │
│ │ 確認済み: [☑️]                                    │ │
│ │ 証明書番号: [________________] *必須                │ │
│ │ 取得日: [____/____/____] *必須                      │ │
│ │ 資格種類: [1 ▼] *必須                              │ │
│ └─────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────┤
│ [💾下書き保存] [✅登録] [❌キャンセル]                  │
└─────────────────────────────────────────────────────────┘
```

## APIエンドポイント
| API名 | エンドポイント | 目的 |
|-------|----------------|------|
| 資格作成 | `POST /api/v1/qualifications/employees` | 新規資格作成 |
| 社員一覧取得 | `GET /api/v1/employees` | 社員一覧取得 |
| 資格種類取得 | `GET /api/v1/qualifications/allowances` | 資格種類一覧取得 |

---

## 初期表示
### 表示モード
| モード | パラメータ | 説明 |
|:--|:--|:--|
| 新規作成 | mode=create | 作成モード（全項目入力可能） |
| 編集 | mode=edit&id={id} | 編集モード（既存データを読み込み） |
| 参照 | mode=view&id={id} | 参照モード（全項目読み取り専用） |

### 共通処理
1. 画面初期化時にモード判定
2. 編集・参照モードの場合、指定IDのデータを取得
3. 取得データをフォームに設定
4. 参照モードの場合、全項目を読み取り専用に設定

---

## 各項目の説明

### 1. 社員コード
| 項目 | 値 |
|:--|:--|
| ラベル | 社員コード |
| 型 | Dropdown |
| 必須 | ○ |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 資格を所有する社員を選択 |

#### 社員ドロップダウン
**API:** `GET /api/v1/employees`

##### リクエストパラメータ
```json
{
  "page": 1,
  "size": 1000
}
```

##### ドロップダウン表示項目
| 表示値 | データソース | 備考 |
|:--|:--|:--|
| 社員を選択 | - | デフォルト選択肢 |
| コード - 名前 | employeeCode - fullName | 社員コードと名前 |

#### バリデーション
- 必須チェック: 未選択の場合「社員コードは必須です。」を表示

### 2. 資格名
| 項目 | 値 |
|:--|:--|
| ラベル | 資格名 |
| 型 | String |
| 必須 | ○ |
| 最大文字数 | 100 |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 資格の名称 |

#### バリデーション
- 必須チェック: 未入力の場合「資格名は必須です。」を表示
- 文字数チェック: 100文字を超える場合「資格名は100文字以内で入力してください。」を表示

### 3. 等級
| 項目 | 値 |
|:--|:--|
| ラベル | 等級 |
| 型 | Dropdown |
| 必須 | ○ |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 資格の等級 |

#### 等級オプション
- 基本
- 応用  
- 専門

#### バリデーション
- 必須チェック: 未選択の場合「等級は必須です。」を表示

### 4. 種類
| 項目 | 値 |
|:--|:--|
| ラベル | 種類 |
| 型 | Dropdown |
| 必須 | ○ |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 資格の種類 |

#### 種類オプション
- 国家資格
- 民間資格
- 国際資格

#### バリデーション
- 必須チェック: 未選択の場合「種類は必須です。」を表示

### 5. 金額
| 項目 | 値 |
|:--|:--|
| ラベル | 金額 |
| 型 | Decimal |
| 必須 | ○ |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 資格手当の金額 |

#### 金額入力形式
- 通貨記号: ¥（自動表示）
- 桁区切り: カンマ区切り（例: ¥15,000）
- 小数点: 整数のみ入力可能
- 入力範囲: 0 < 金額 ≤ 999,999,999

#### バリデーション
- 必須チェック: 未入力の場合「金額は必須です。」を表示
- 数値チェック: 数値以外の場合「金額は数値で入力してください。」を表示
- 範囲チェック: 0以下の場合「金額は0より大きい値を入力してください。」を表示
- 範囲チェック: 999,999,999を超える場合「金額は999,999,999以下で入力してください。」を表示

### 6. 確認済み
| 項目 | 値 |
|:--|:--|
| ラベル | 確認済み |
| 型 | Checkbox |
| 必須 | |
| 備考 | 資格の確認状態 |

### 7. 証明書番号
| 項目 | 値 |
|:--|:--|
| ラベル | 証明書番号 |
| 型 | String |
| 必須 | ○ |
| 最大文字数 | 50 |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 証明書のシリアル番号 |

#### バリデーション
- 必須チェック: 未入力の場合「証明書番号は必須です。」を表示
- 文字数チェック: 50文字を超える場合「証明書番号は50文字以内で入力してください。」を表示
- 重複チェック: 証明書番号が既に存在する場合「この証明書番号は既に使用されています。」を表示

### 8. 取得日
| 項目 | 値 |
|:--|:--|
| ラベル | 取得日 |
| 型 | Date |
| 必須 | ○ |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 資格の取得日 |

#### 日付形式
- 形式: DD/MM/YYYY
- 未来日は入力不可

#### バリデーション
- 必須チェック: 未入力の場合「取得日は必須です。」を表示
- 日付チェック: 未来日の場合「取得日は未来の日付にできません。」を表示

### 9. 資格種類
| 項目 | 値 |
|:--|:--|
| ラベル | 資格種類 |
| 型 | Dropdown |
| 必須 | ○ |
| 背景色 | #FFFFCC（必須項目） |
| 備考 | 資格手当テーブルとの関連付け |

#### 資格種類ドロップダウン
**API:** `GET /api/v1/qualifications/allowances`

##### リクエストパラメータ
```json
{
  "page": 1,
  "size": 1000
}
```

##### ドロップダウン表示項目
| 表示値 | データソース | 備考 |
|:--|:--|:--|
| 資格種類を選択 | - | デフォルト選択肢 |
| 名前 - 種類 | name - type | 資格名と種類 |

#### バリデーション
- 必須チェック: 未選択の場合「資格種類は必須です。」を表示

---

## 下書き保存処理
### 下書き保存ボタン
- バリデーションを実行せずにデータを保存
- 保存成功時: 「下書き保存しました。」メッセージ表示
- 保存失敗時: エラーメッセージ表示

### 下書き保存API
**API:** `POST /api/v1/qualifications/employees`

#### 新規作成時
```json
{
  "employeeCode": "EMP001",
  "name": "基本情報技術者",
  "grade": "基本",
  "type": "国家資格",
  "amount": 5000.00,
  "isChecked": true,
  "certificateNumber": "FE2024001",
  "acquisitionDate": "2024-03-15",
  "qualificationTypeId": 1
}
```

#### 編集時
```json
{
  "id": 123,
  "employeeCode": "EMP001",
  "name": "基本情報技術者",
  "grade": "基本",
  "type": "国家資格",
  "amount": 5000.00,
  "isChecked": true,
  "certificateNumber": "FE2024001",
  "acquisitionDate": "2024-03-15",
  "qualificationTypeId": 1
}
```

---

## 登録処理
### 登録ボタン
1. 全項目のバリデーション実行
2. バリデーションエラーがある場合: エラーメッセージ表示、処理終了
3. バリデーション成功時: 登録確認ダイアログ表示

### 登録確認ダイアログ
#### ダイアログ内容
- タイトル: "登録確認"
- メッセージ: "この資格を登録しますか？"
- ボタン: [キャンセル] [登録]

#### 登録実行処理
1. API呼び出し（下書き保存と同じAPI）
2. 登録成功時: 成功メッセージ表示、一覧画面に遷移
3. 登録失敗時: エラーメッセージ表示

---

## 各種チェック

### 1. 必須項目チェック
必須項目が未入力の場合、該当項目にエラーメッセージを表示

### 2. 文字数チェック
各項目の最大文字数を超える場合、エラーメッセージを表示

### 3. 金額チェック
- 金額形式のチェック
- 値の範囲チェック

### 4. 日付チェック
- 日付形式のチェック
- 未来日でないことのチェック

### 5. 重複チェック
- 証明書番号の重複チェック
- 社員の資格重複チェック

---

## 完了メッセージ

### 成功メッセージ
- 下書き保存完了: "下書き保存しました。"
- 登録完了: "資格を登録しました。"

### エラーメッセージ
- バリデーションエラー: 該当項目にエラーメッセージ表示
- API通信エラー: "データの保存に失敗しました。"
- 重複エラー: "この証明書番号は既に使用されています。"

---

## ナビゲーション

### 戻るボタン
- 一覧画面に戻る
- 未保存の変更がある場合: 確認ダイアログ表示

### キャンセルボタン
- 一覧画面に戻る
- 未保存の変更がある場合: 確認ダイアログ表示

---

## エラーハンドリング

### API エラー
- 通信エラー: "サーバーに接続できません。"
- 認証エラー: "ログインが必要です。"
- 権限エラー: "この操作を実行する権限がありません。"

### バリデーションエラー
- 必須項目エラー: 該当項目の背景色を変更し、エラーメッセージ表示
- 文字数エラー: 該当項目にエラーメッセージ表示
- 重複エラー: 該当項目にエラーメッセージ表示

---

## データ取得処理

### 編集・参照モード時のデータ取得
**API:** `GET /api/v1/qualifications/employees/{id}`

#### リクエストパラメータ
**GET** `/api/v1/qualifications/employees/{id}`

#### パスパラメータ
| パラメータ名 | 型 | 必須 | 備考 |
|:--|:--|:--|:--|
| id | Int | ○ | 取得対象の資格ID |

#### レスポンス処理
- 取得成功時: フォームにデータを設定
- 取得失敗時: エラーメッセージ表示、一覧画面に戻る

---

*このドキュメントは人事管理システムの開発・保守に使用されます*
